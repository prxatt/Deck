<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Surface Tension: Digital Drip Pitch v43</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://use.typekit.net/jhs3mli.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Tron';
            src: url('https://fonts.cdnfonts.com/s/13884/TRON.woff') format('woff');
            font-weight: normal; font-style: normal; font-display: swap;
        }
        :root {
            --primary-emerald: #10b981; --primary-purple: #a855f7; --primary-teal: #06b6d4;
            --text-primary: rgba(243, 244, 246, 1); --text-secondary: rgba(209, 213, 219, 0.9);
            --bg-primary: #000000; --bg-secondary: #0a0e1a; --border-color: rgba(255, 255, 255, 0.1);
            --font-heading: "ivypresto-display", serif; --font-body: 'Inter', sans-serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; width: 100%; overflow: hidden; background-color: var(--bg-primary); font-family: var(--font-body); color: var(--text-primary); -webkit-tap-highlight-color: transparent; }
        
        #loading-screen { position: fixed; inset: 0; background-color: var(--bg-primary); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10000; transition: opacity 1.5s ease-in-out, visibility 1.5s ease-in-out; }
        #loading-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        #loading-canvas { width: 250px; height: 250px; }
        .loading-text { 
            margin-top: 1rem; font-family: var(--font-heading); font-size: 0.8rem;
            font-weight: 400; color: var(--text-primary); text-shadow: 0 0 8px rgba(255, 255, 255, 0.3); 
            letter-spacing: 0.6em; margin-left: 0.6em;
        }
        
        #app-container { width: 100%; height: 100%; position: relative; opacity: 0; transition: opacity 1s ease-in; }
        #app-container.loaded { opacity: 1; }
        .slide { position: absolute; inset: 0; opacity: 0; visibility: hidden; transition: opacity 0.8s ease-in-out; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding: 2rem; padding-top: 7rem; overflow-y: auto; scrollbar-width: thin; scrollbar-color: var(--primary-emerald) transparent; cursor: default; }
        .slide.active { opacity: 1; visibility: visible; z-index: 10; }
        .slide-header { width: 100%; max-width: 1200px; margin-bottom: 2.5rem; text-align: center; animation: fadeIn 0.8s ease-out; }
        .slide-content { width: 100%; max-width: 1200px; padding-bottom: 8rem; animation: fadeIn 1s ease-out 0.2s; animation-fill-mode: backwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .display-1 { font-family: 'Tron', var(--font-heading), sans-serif; font-size: clamp(2.5rem, 5vw, 4.5rem); line-height: 1.1; text-transform: uppercase; letter-spacing: 2px; }
        .display-2 { font-family: var(--font-heading); font-size: clamp(2rem, 4vw, 3.2rem); font-weight: 500; line-height: 1.2; }
        .heading-1 { font-family: var(--font-heading); font-size: clamp(1.5rem, 3vw, 2rem); font-weight: 500; line-height: 1.3; }
        .body-large { font-family: var(--font-body); font-size: clamp(1rem, 1.5vw, 1.1rem); line-height: 1.8; font-weight: 400; color: var(--text-secondary); }
        .body-regular { font-family: var(--font-body); font-size: clamp(0.9rem, 1.2vw, 1rem); line-height: 1.7; font-weight: 400; color: var(--text-secondary); }
        
        .app-header { position: fixed; top: 0; left: 0; width: 100%; padding: 1.5rem 3rem; display: flex; justify-content: space-between; align-items: center; z-index: 1001; pointer-events: none; }
        .app-header > * { pointer-events: all; }
        #header-logo-canvas { width: 60px; height: 60px; cursor: pointer; }
        
        .navigation-container { position: fixed; bottom: 0; left: 0; right: 0; height: 100px; z-index: 1001; pointer-events: none;}
        .navigation-container:hover .navigation { opacity: 1; }
        .navigation { pointer-events: all; position: absolute; bottom: 1rem; left: 50%; transform: translateX(-50%); display: flex; align-items: center; gap: 0.5rem; backdrop-filter: blur(8px); background-color: rgba(10,14,26,0.7); border: 1px solid var(--border-color); padding: 0.5rem 0.75rem; border-radius: 99px; opacity: 0.5; transition: opacity 0.4s ease-in-out; }
        
        .nav-arrow { background-color: transparent; border: none; color: white; cursor: pointer; padding: 0.5rem; transition: transform 0.2s ease, color 0.2s ease; border-radius: 50%; }
        .nav-arrow:hover { color: var(--primary-emerald); transform: scale(1.1); }
        .nav-arrow svg { width: 24px; height: 24px; stroke-width: 2; }
        .nav-dots { display: flex; gap: 0.5rem; align-items: center; }
        .nav-dot { width: 8px; height: 8px; background-color: rgba(255,255,255,0.3); border-radius: 50%; transition: all 0.3s ease; cursor: pointer; }
        .nav-dot:hover { background-color: rgba(255,255,255,0.6); }
        .nav-dot.active { background-color: var(--primary-emerald); box-shadow: 0 0 5px var(--primary-emerald); transform: scale(1.2); }
        
        #slide-1 .cover-content-wrapper { position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: space-between; align-items: center; padding: 15vh 0; }
        #slide-1 .display-1 { margin-top: 0; }
        #slide-1 .cover-text-group { text-align: center; margin-bottom: 0; }
        #slide-1 .digital-drip-group { display: flex; align-items: center; justify-content: center; gap: 1rem; }
        #slide-1 .digital-drip { 
            font-family: var(--font-heading); color: var(--primary-purple); 
            text-shadow: 0 0 10px rgba(168, 85, 247, 0.7); 
            letter-spacing: 0.1em; font-size: clamp(1.2rem, 2vw, 1.8rem); 
            text-transform: uppercase;
            animation: flicker 4s infinite alternate;
        }
        @keyframes flicker {
            0%, 18%, 22%, 25%, 53%, 57%, 100% {
                text-shadow:
                0 0 4px var(--primary-purple),
                0 0 11px var(--primary-purple),
                0 0 19px var(--primary-purple),
                0 0 40px var(--primary-purple),
                0 0 80px var(--primary-purple);
                opacity: 1;
            }
            20%, 24%, 55% { text-shadow: none; opacity: 0.6; }
        }

        #slide-1 .cover-text-group p { color: rgba(209, 213, 219, 1); font-weight: 500; font-size: clamp(1rem, 1.5vw, 1.2rem); }
        #slide-1 .creator-names-container { position: absolute; bottom: 2rem; left: 50%; transform: translateX(-50%); width: 100%; max-width: 1200px; padding: 0 2rem; z-index: 10; display: flex; justify-content: space-between; }

        .card { background: rgba(10, 14, 26, 0.7); backdrop-filter: blur(5px); border: 1px solid var(--border-color); border-radius: 1rem; padding: 2.5rem; }
        
        .portal-quote { font-style: italic; color: var(--primary-emerald); text-shadow: 0 0 10px rgba(16, 185, 129, 0.5); font-size: clamp(1.1rem, 2vw, 1.4rem); font-weight: 500; }
        #drip-ripple-container { width: 100%; height: 250px; margin: 1rem auto; position: relative; cursor: pointer; }
        
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; }
        .menu-item-card { background: rgba(10, 14, 26, 0.8); border: 1px solid var(--border-color); border-radius: 1rem; padding: 1.5rem; cursor: pointer; transition: all 0.3s ease; }
        .menu-item-card:hover { border-color: var(--primary-emerald); transform: translateY(-5px); }
        .item-card-title { font-weight: 600; margin-bottom: 0.5rem; font-size: 1.1rem; }
        .item-card-desc { font-size: 0.85rem; color: var(--text-secondary); }
        .item-card-price { font-weight: 700; margin-top: 1rem; }
        
        #menu-modal-container, #revenue-modal-container { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; z-index: 5000; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; }
        #menu-modal-container.visible, #revenue-modal-container.visible { opacity: 1; pointer-events: all; }
        .menu-modal-content, .revenue-modal-content { max-width: 600px; width: 90%; }
        .menu-modal-close { position: absolute; top: 2rem; right: 2rem; background: none; border: none; color: white; font-size: 2rem; cursor: pointer; }

        .venue-section { margin-top: 2rem; }
        .venue-point-cloud { height: 40vh; width: 100%; position: relative; margin-bottom: 2rem; border-radius: 1rem; overflow: hidden; background: radial-gradient(ellipse at center, rgba(16, 185, 129, 0.05) 0%, rgba(0,0,0,0) 70%);}
        .venue-link { color: var(--primary-emerald); text-decoration: none; transition: all 0.3s ease; }
        .venue-link:hover { color: var(--primary-purple); text-decoration: underline; }
        .data-section { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem; align-items: stretch; }
        .data-card { display: flex; flex-direction: column; }
        .data-card ul { flex-grow: 1; list-style-position: outside; padding-left: 1rem; line-height: 1.6; }
        .data-card li { padding: 0.75rem 0; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: flex-start; gap: 0.75rem; }
        .data-card li:before { content: "â–¶"; color: var(--primary-emerald); font-size: 0.8rem; flex-shrink: 0; margin-top: 0.25rem; }
        .source-note { font-size: 0.7rem; color: #6b7280; text-align: right; margin-top: 0.5rem; font-style: italic;}

        .venue-controls { display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap; align-items: center; padding: 0; background: transparent; border-radius: 12px; justify-content: center; z-index: 10; width: fit-content; max-width: 95%; align-self: center; }
        .venue-mode-btn { background: rgba(16, 185, 129, 0.2); border: 1px solid var(--primary-emerald); color: var(--primary-emerald); padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: all 0.2s ease; user-select: none; font-weight: 600; }
        .venue-mode-btn:hover, .venue-mode-btn.active { background: var(--primary-emerald); color: black; box-shadow: 0 0 15px var(--primary-emerald); }
        
        .interactive-venue { position: relative; width: 100%; height: 450px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(168, 85, 247, 0.03)); border: 2px dashed rgba(16, 185, 129, 0.3); border-radius: 1rem; overflow: hidden; touch-action: none; margin: 1rem 0; }
        .venue-item { position: absolute; background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.4); border-radius: 8px; cursor: grab; user-select: none; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.85rem; text-align: center; padding: 1rem; transition: border-color 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease; will-change: transform, top, left, width, height; backdrop-filter: blur(5px); transform-origin: center center; color: var(--text-primary); }
        .venue-item:active { cursor: grabbing; }
        .venue-item:hover { border-color: var(--primary-emerald); transform: scale(1.02); }
        .venue-item.selected { border-color: var(--primary-purple); background: rgba(168, 85, 247, 0.2); box-shadow: 0 0 20px rgba(168, 85, 247, 0.5); }
        .venue-item-title { font-weight: 600; margin-bottom: 0.25rem; pointer-events: none; }
        .venue-item-desc { font-size: 0.75rem; color: var(--text-secondary); pointer-events: none; }
        
        .venue-item[data-type="bar"] { background: transparent; border: none; padding: 0; }
        .l-bar-container { width: 100%; height: 100%; position: relative; }
        .l-bar-container::before, .l-bar-container::after { content: ''; position: absolute; background: rgba(168, 85, 247, 0.2); border: 2px solid var(--primary-purple); border-radius: 4px; box-sizing: border-box; }
        .venue-item[data-type="bar"]:hover .l-bar-container::before, .venue-item[data-type="bar"]:hover .l-bar-container::after { background: rgba(168, 85, 247, 0.3); }
        .l-bar-container::before { width: 100%; height: 35%; top: 0; left: 0; }
        .l-bar-container::after { width: 35%; height: 100%; top: 0; left: 0; }
        .venue-item[data-type="bar"] .venue-item-title, .venue-item[data-type="bar"] .venue-item-desc { color: var(--primary-purple); z-index: 1; text-shadow: 0 0 5px #000; }

        .venue-item[data-type="dj"] { background: rgba(16, 185, 129, 0.2); border-color: var(--primary-emerald); color: var(--primary-emerald); }
        .venue-item[data-type="seating"] { background: rgba(6, 182, 212, 0.2); border-color: var(--primary-teal); color: var(--primary-teal); }
        .venue-item[data-type="dance"] { background: rgba(245, 158, 11, 0.2); border-color: #f59e0b; color: #f59e0b; }

        .marketing-layout { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 2rem; }
        .marketing-charts-container { grid-column: span 2; display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem; }
        .marketing-item { background: rgba(10, 14, 26, 0.6); border: 1px solid var(--border-color); border-radius: 12px; transition: all 0.3s ease; cursor: pointer; overflow: hidden; }
        .marketing-item:hover { border-color: var(--primary-emerald); background: rgba(16, 185, 129, 0.05); }
        .marketing-header { padding: 1.5rem; display: flex; justify-content: space-between; align-items: center; background: rgba(16, 185, 129, 0.1); border-bottom: 1px solid rgba(16, 185, 129, 0.3); }
        .marketing-title { color: var(--primary-emerald); font-weight: 600; }
        .marketing-cost-number { font-family: 'Tron', sans-serif; font-size: 1.6rem; color: var(--text-primary); line-height: 1; }
        .marketing-details { padding: 0 1.5rem; max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out; }
        .marketing-item.expanded .marketing-details { max-height: 1200px; padding-top: 1.5rem; padding-bottom: 1.5rem; }
        .execution-tabs { display: flex; gap: 1rem; margin-top: 1rem; border-bottom: 1px solid var(--border-color); }
        .execution-tab { padding: 0.5rem 0; border-bottom: 2px solid transparent; cursor: pointer; color: var(--text-secondary); }
        .execution-tab.active { color: var(--primary-emerald); border-bottom-color: var(--primary-emerald); font-weight: 600;}
        .execution-content { display: none; margin-top: 1rem; }
        .execution-content.active { display: block; }
        
        .sextant-layout { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem; margin-top: 2rem; }
        .sextant-item { background: rgba(10, 14, 26, 0.6); border: 1px solid var(--border-color); border-radius: 12px; transition: all 0.3s ease; cursor: pointer; overflow: hidden; }
        .sextant-item:hover { border-color: var(--primary-purple); transform: translateY(-5px); }
        .sextant-header { padding: 1.5rem; display: flex; justify-content: space-between; align-items: center; }
        .sextant-title { color: var(--primary-purple); font-weight: 600; font-size: 1.1rem; }
        .sextant-details { padding: 0 1.5rem; max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out; }
        .sextant-item.expanded .sextant-details { max-height: 1200px; padding-bottom: 1.5rem; }
        
        .financial-calculator-layout { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem; margin-top: 2rem; align-items: flex-start; }
        .financial-calculator-container { background: linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(168, 85, 247, 0.05)); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 1rem; padding: 2.5rem; display: flex; flex-direction: column; gap: 1rem; }
        .calc-row { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px dashed rgba(255, 255, 255, 0.1); flex-wrap: wrap; }
        .calc-input-field { background: rgba(0,0,0,0.3); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; padding: 0.4rem 0.8rem; color: var(--text-primary); width: 80px; text-align: right; font-weight: 600; font-size: 1rem; }
        .calc-final-result { font-family: 'Tron', sans-serif; font-size: 2.2rem; text-align: right; min-width: 140px; color: var(--primary-purple); text-shadow: 0 0 10px rgba(168, 85, 247, 0.5);}
        .calc-label { flex-basis: 60%; }
        .calc-input-group { flex-basis: 40%; text-align: right; }
        #total-revenue-row { cursor: pointer; transition: background-color 0.2s ease; border-radius: 8px; }
        #total-revenue-row:hover { background-color: rgba(255,255,255,0.05); }

        .growth-section { display: grid; grid-template-columns: 1fr; gap: 2.5rem; }
        .metrics-column { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .metric-card { border: 1px solid var(--border-color); border-radius: 12px; padding: 1.5rem; text-align: center; cursor: pointer; transition: all 0.3s ease; overflow: hidden; position: relative; }
        .metric-card:hover { transform: scale(1.05); }
        .metric-card.emerald { background: rgba(16, 185, 129, 0.1); border-color: rgba(16, 185, 129, 0.4); }
        .metric-card.purple { background: rgba(168, 85, 247, 0.1); border-color: rgba(168, 85, 247, 0.4); }
        .metric-card.teal { background: rgba(6, 182, 212, 0.2); border-color: rgba(6, 182, 212, 0.4); }
        .metric-card.yellow { background: rgba(245, 158, 11, 0.1); border-color: rgba(245, 158, 11, 0.4); }
        .metric-value { font-size: 2.2rem; font-weight: 800; margin-bottom: 0.5rem; font-family: 'Inter', sans-serif; }
        .metric-details { max-height: 0; overflow: hidden; transition: all 0.5s ease; margin-top: 1rem; font-size: 0.85rem; text-align: left;}
        .metric-card.expanded .metric-details { max-height: 200px; }
        
        .growth-chart-container, .chart-container { background: rgba(10, 14, 26, 0.4); border: 1px solid var(--border-color); border-radius: 1rem; position: relative; height: 450px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 1rem; }
        .chart-title { text-align: center; color: var(--primary-emerald); font-size: 1.1rem; font-weight: 500; margin-bottom: 1rem; }
        .chart-canvas { width: 100% !important; height: 100% !important; }

        .task-planner { background: rgba(10, 14, 26, 0.6); border: 1px solid var(--border-color); border-radius: 1.5rem; padding: 2.5rem; }
        .task-filters { display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; }
        .task-filter { padding: 0.5rem 1rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem; }
        .task-filter.active { background: var(--primary-emerald); border-color: var(--primary-emerald); color: black; font-weight: 600; }
        .task-planner-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem; }
        .task-card { background: rgba(0,0,0, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; transition: all 0.3s ease; overflow: hidden; }
        .task-card:hover { border-color: var(--primary-emerald); background: rgba(16, 185, 129, 0.05); }
        .task-main-content { padding: 1.5rem; cursor: pointer; }
        .task-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem; }
        .task-week { color: var(--primary-emerald); font-weight: 600; font-size: 0.9rem; margin-bottom: 0.25rem; }
        .task-title-group { flex-grow: 1; margin-right: 1rem; }
        .task-assignee { padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; text-transform: capitalize; text-align: center; white-space: nowrap; }
        .task-assignee.pratt { background: rgba(16, 185, 129, 0.2); color: var(--primary-emerald); }
        .task-assignee.sextant { background: rgba(168, 85, 247, 0.2); color: var(--primary-purple); }
        .task-assignee.diana { background: rgba(6, 182, 212, 0.2); color: var(--primary-teal); }
        .task-assignee.riley { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .task-assignee.collaborative { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .task-details { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-out, padding 0.5s ease-out; background: rgba(0,0,0,0.2); }
        .task-card.expanded .task-details { max-height: 500px; padding: 1.5rem; }
        .task-calendar-btn { display: inline-flex; align-items: center; gap: 0.5rem; margin-top: 1rem; background: var(--primary-teal); color: black; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600; font-size: 0.8rem; text-decoration: none; transition: transform 0.2s ease; }
        .task-calendar-btn:hover { transform: scale(1.05); }
        .progress-bar-container { margin-top: 0.75rem; background-color: rgba(255,255,255,0.1); border-radius: 99px; height: 8px; overflow: hidden; cursor: pointer; display: flex; }
        .progress-segment { height: 100%; flex-grow: 1; transition: background-color: 0.3s; }
        .progress-segment:not(:first-child) { border-left: 1px solid rgba(0,0,0,0.3); }
        .task-notes-input { width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); border-radius: 8px; padding: 0.5rem; color: var(--text-primary); margin-top: 1rem; font-family: var(--font-body); font-size: 0.85rem;}

        .creators-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 2rem; margin-top: 2rem; }
        .creator-card { position: relative; background: rgba(10, 14, 26, 0.8); border: 1px solid var(--border-color); border-radius: 1rem; padding: 2.5rem; overflow: hidden; display: flex; flex-direction: column; }
        .creator-particles { position: absolute; inset: 0; pointer-events: none; z-index: 0;}
        .creator-content { position: relative; z-index: 1; flex-grow: 1; display: flex; flex-direction: column; }
        .creator-content ul { list-style-position: outside; padding-left: 1rem; margin-top: 1.5rem; flex-grow: 1; }
        
        .freestanding-quote { margin: 2rem auto 2rem; max-width: 700px; text-align: center; }
        .freestanding-quote .quote-line { font-family: var(--font-heading); font-size: clamp(1.5rem, 3vw, 2.2rem); line-height: 1.4; letter-spacing: 0.03em; font-weight: 400; color: var(--text-secondary); }
        .freestanding-quote .quote-line.emphasis { font-weight: 600; color: var(--primary-emerald); text-shadow: 0 0 15px rgba(16, 185, 129, 0.4); }
        
        #finale-container { height: 100vh; width: 100vw; position: fixed; top: 0; left: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; background: radial-gradient(ellipse at center, rgba(16, 185, 129, 0.1) 0%, rgba(0,0,0,0) 70%);}
        #finale-animation { position: absolute; inset: 0; z-index: -1; }
        .finale-content { position: absolute; bottom: 5rem; left: 0; right: 0; padding: 2rem; z-index: 1; pointer-events: none; text-align: center; width: 100%; max-width: 1200px; margin: 0 auto; }
        #finale-title { 
            font-size: clamp(1.4rem, 2.5vw, 1.8rem); 
            font-weight: 400; color: var(--text-primary); 
            text-align: center; 
            z-index: 1; 
            width: 80%; 
            text-shadow: 0 0 8px rgba(229, 228, 226, 0.9), 0 0 20px rgba(16, 185, 129, 0.5); 
            font-family: var(--font-heading); 
            text-transform: lowercase; 
            position: absolute; top: 28%; 
            left: 50%; transform: translate(-50%, -50%); 
        }
        .finale-links { display: flex; justify-content: space-between; align-items: center; width: 100%; pointer-events: all; }
        .finale-link { color: white; text-decoration: none; font-size: 0.9rem; font-weight: 400; transition: all 0.3s ease; z-index: 100; }
        .finale-link:hover { color: var(--primary-emerald); }
        
        #cover-sphere-container::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 150%;
            height: 150%;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, rgba(16, 185, 129, 0.2) 0%, rgba(168, 85, 247, 0.1) 40%, rgba(0,0,0,0) 70%);
            filter: blur(40px);
            z-index: -2;
            animation: pulse-glow 10s infinite alternate;
        }
        @keyframes pulse-glow {
            from { opacity: 0.7; transform: translate(-50%, -50%) scale(0.9); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
        }

        .consciousness-tech-icon { width: 80px; height: 80px; margin: 0 auto; position: relative; cursor: pointer; transition: transform 0.2s ease; }
        .consciousness-tech-icon:hover { transform: scale(1.1); }
        
        .event-timeline-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; }
        .timeline-event { background: rgba(10, 14, 26, 0.8); border: 1px solid var(--border-color); border-radius: 1rem; position: relative; z-index: 1; transition: all 0.3s ease; display: flex; flex-direction: column; cursor: pointer; }
        .timeline-event:hover { border-color: var(--primary-emerald); transform: translateY(-5px); }
        .timeline-event-main { padding: 1.5rem; flex-grow: 1; }
        .timeline-event-details { max-height: 0; overflow: hidden; padding: 0 1.5rem; transition: all 0.5s ease; }
        .timeline-event.expanded .timeline-event-details { max-height: 500px; padding-bottom: 1.5rem; }
        .timeline-event .time { font-weight: 700; color: var(--primary-purple); margin-bottom: 0.5rem; }

        .tech-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; z-index: 5000; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; }
        .tech-modal.visible { opacity: 1; pointer-events: all; }
        .menu-modal-details { font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.75rem; display: flex; justify-content: space-between; opacity: 0.8;}
        

        @media (max-width: 900px) {
            .data-section, .marketing-layout, .sextant-layout, .creators-grid, .marketing-charts-container, .event-timeline-grid { grid-template-columns: 1fr; }
            .growth-section { flex-direction: column-reverse; }
        }
        @media (max-width: 768px) {
            .slide { padding: 1rem; padding-top: 6rem; }
            .app-header { padding: 1rem 1.5rem; }
            #header-logo-canvas { width: 50px; height: 50px; }
            .finale-content { padding: 2rem; bottom: 2rem; }
            .finale-links { flex-direction: column; gap: 2rem; align-items: center;}
            .creator-names-container { padding: 0 1rem; bottom: 1rem; }
            .freestanding-quote { margin: 1rem auto 3rem; }
            #finale-title { position: static; transform: none; top: auto; left: auto; margin-bottom: 2rem; font-size: clamp(1.5rem, 5vw, 1.8rem); }
            .financial-calculator-layout { grid-template-columns: 1fr; }
            .financial-calculator-container { padding: 1.5rem; }
            .calc-final-result { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div id="loading-screen">
        <canvas id="loading-canvas"></canvas>
        <p class="loading-text">LOADING CONSCIOUSNESS</p>
    </div>

    <div id="app-container">
        <header class="app-header" id="app-header">
            <canvas id="header-logo-canvas"></canvas>
            <div id="slide-indicator" class="body-regular">01 / 11</div>
        </header>

        <div id="slide-container"></div>
        <div id="tech-modal-container"></div>
        <div id="menu-modal-container"></div>
        <div id="revenue-modal-container"></div>

        <div class="navigation-container">
            <nav class="navigation" id="navigation">
                <button class="nav-arrow" id="prevBtn" aria-label="Previous Slide">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg>
                </button>
                <div class="nav-dots" id="nav-dots"></div>
                <button class="nav-arrow" id="nextBtn" aria-label="Next Slide">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" /></svg>
                </button>
            </nav>
        </div>
    </div>
    
    <audio id="bellSound" src="https://assets.codepen.io/225363/bell-sound.wav" preload="auto"></audio>
    <audio id="heartSound" src="https://assets.codepen.io/225363/heart-sound.wav" preload="auto"></audio>
    <audio id="starSound" src="https://assets.codepen.io/225363/star-sound.wav" preload="auto"></audio>

<script>
// --- GLOBAL ERROR HANDLER ---
window.onerror = function(message, source, lineno, colno, error) {
    console.error("Global error caught:", { message, source, lineno, colno, error });
    const errorModal = document.createElement('div');
    errorModal.style.cssText = `position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; font-family: 'Inter', sans-serif; z-index: 10002; text-align: center; padding: 20px; backdrop-filter: blur(8px);`;
    errorModal.innerHTML = `<h2 style="font-size: 2rem; color: #ef4444; margin-bottom: 1rem;">System Anomaly Detected</h2><p style="margin-bottom: 1.5rem;">An unexpected cosmic ripple occurred. Please recalibrate.</p><p style="font-size: 0.8rem; color: #9ca3af; margin-bottom: 2rem;">${error ? error.message : message || 'Unknown anomaly'}</p><button onclick="window.location.reload()" style="padding: 0.75rem 2rem; background: #10b981; color: black; border: none; border-radius: 99px; font-weight: bold; cursor: pointer;">Realign Reality</button>`;
    if (!document.body.querySelector('#error-modal')) { errorModal.id = 'error-modal'; document.body.appendChild(errorModal); }
    return true; 
};

// --- SLIDE TEMPLATES --- //
const slideTemplates = [
    { 
      title: null, 
      content: `<div id="cover-sphere-container" class="absolute inset-0 -z-10"></div><div class="cover-content-wrapper"><h1 class="display-1 text-white" style="text-shadow: 0 0 30px rgba(16, 185, 129, 0.4);">Surface Tension</h1><div class="cover-text-group"><div class="digital-drip-group"><h2 class="digital-drip">DIGITAL DRIP</h2><p class="mx-4">x</p><p>Sextant Coffee Roasters</p></div></div><div class="creator-names-container"><div class="text-left text-xs body-regular tracking-wider uppercase text-gray-400">Pratt Majmudar<br><span class="text-gray-500">CEO & Creative Director</span></div><div class="text-right text-xs body-regular tracking-wider uppercase text-gray-400">Diana Komakhidze<br><span class="text-gray-500">Chief Designer & Marketing Lead</span></div></div></div>` 
    },
    { 
        title: "The Portal Philosophy", 
        content: `<p class="body-large mt-4 max-w-4xl mx-auto portal-quote">We are not creating events; we are engineering temporary autonomous zones. Immersive experiences that blur the boundaries between art, music, and digital reality, inviting a discerning audience to explore the layers beneath the surface of everyday life. This is where stillness meets sound, and community is cultivated through shared presence.</p><div class="mt-12 grid md:grid-cols-2 gap-8"><div class="card"><h3 class="heading-1 text-emerald-400">The SF Cultural Opportunity</h3><ul class="body-regular mt-6 list-disc list-inside space-y-3"><li><strong>The Experience Dividend:</strong> 78% of millennials in high-cost urban areas like San Francisco now prioritize spending on unique experiences over material goods, creating a significant market for premium, curated events. <span class="text-xs text-gray-400">(Source: Harris Group, 2024)</span></li><li><strong>The Third Space Vacuum:</strong> Post-pandemic work shifts have intensified the search for "Third Spaces." 65% of professionals aged 25-40 report a desire for social environments that are not home or the office, but offer cultural and intellectual substance. <span class="text-xs text-gray-400">(Source: SF Chamber of Commerce Report, 2025)</span></li><li><strong>The Rise of Intentional Nightlife:</strong> The "Sober Curious" and wellness movements are converging. 45% of Northern Californian consumers aged 25-40 are actively seeking high-energy, non-alcoholic-centric nightlife options that foster genuine connection over intoxication. <span class="text-xs text-gray-400">(Source: NielsenIQ, 2025)</span></li></ul></div><div class="card"><h3 class="heading-1 text-purple-400">Our Curated Solution</h3><ul class="body-regular mt-6 list-disc list-inside space-y-3"><li><strong>Engineered Serendipity:</strong> An intentionally designed environment that fosters presence and authentic connection. We move beyond superficial networking to create a space where meaningful interactions are not just possible, but inevitable. This is a repeatable model for transforming any space into a cultural hub.</li><li><strong>High-Fidelity Sonics:</strong> A meticulously calibrated audio journey that serves as the centerpiece of the experience. This is not background music; it is the narrative, rewarding deep, attentive listening and creating a state of collective flow.</li><li><strong>A Hub for the Creative Class:</strong> We are building a nexus for a community seeking culturally rich, exclusive experiences. Surface Tension is a signal for those who desire more than a standard night outâ€”they seek transformation and belonging.</li></ul></div></div><div id="consciousness-tech" class="mt-8 card"><h3 class="heading-1 text-center mb-6">Conscious Technology</h3><div class="grid md:grid-cols-3 gap-6 text-center"><div class="p-4" onclick="Content.showTechModal('resonance')"><div class="consciousness-tech-icon" id="bell-cloud"></div><p class="font-semibold body-regular mt-2">Frequency Resonance</p></div><div class="p-4" onclick="Content.showTechModal('presence')"><div class="consciousness-tech-icon" id="heart-cloud"></div><p class="font-semibold body-regular mt-2">Embodied Presence</p></div><div class="p-4" onclick="Content.showTechModal('listening')"><div class="consciousness-tech-icon" id="star-cloud"></div><p class="font-semibold body-regular mt-2">Deep Listening</p></div></div></div>` 
    },
    { 
        title: "The Digital Drip Experience", 
        content: `<p class="body-large mt-4 max-w-4xl mx-auto">The experience is a meticulously crafted sensory narrative, architected to guide attendees from a state of arrival to one of transcendence. We use a seamless flow of sound, taste, and visual stimulation to deconstruct the ordinary and reveal the sublime. This is a turnkey activation that transforms Sextant into an evening cultural hotspot.</p><div id="drip-ripple-container"></div><div class="card my-8"><div id="event-timeline" class="event-timeline-grid"></div></div><div class="card mt-8"><h3 class="heading-1 text-center mb-6 text-emerald-400">Curated Menu</h3><div id="menu-grid" class="menu-grid"></div></div>`
    },
    { 
        title: "Venue Intelligence", 
        content: `<p class="body-large mt-4 max-w-4xl mx-auto">Sextant Coffee at <a href="https://maps.google.com/maps?q=539+Valencia+St,+San+Francisco,+CA" target="_blank" class="venue-link">539 Valencia St</a> is more than a location; it's a cultural anchor. Positioned at the nexus of the Mission's creative and culinary scenes, it provides an authentic foundation to engage San Francisco's most discerning demographic. Our model respects and elevates the existing space, requiring minimal alteration for maximum impact.</p><div class="venue-section flex flex-col items-center"><div class="venue-point-cloud" id="venue-point-cloud"></div><div class="interactive-venue" id="interactive-venue"><div class="venue-controls"><button class="venue-mode-btn active" onclick="setVenueMode('move')">Move</button><button class="venue-mode-btn" onclick="setVenueMode('resize')">Resize</button><button class="venue-mode-btn" onclick="setVenueMode('rotate')">Rotate</button></div><div class="venue-item" style="top: 20%; left: 15%; width: 140px; height: 80px;" data-type="dj"><div class="venue-item-title">DJ Booth</div><div class="venue-item-desc">Central sonic hub</div></div><div class="venue-item" style="top: 55%; left: 5%; width: 120px; height: 100px;" data-type="bar"><div class="l-bar-container"><div class="venue-item-title">Bar</div><div class="venue-item-desc">Service area</div></div></div><div class="venue-item" style="top: 30%; left: 65%; width: 100px; height: 80px;" data-type="seating"><div class="venue-item-title">Seating</div><div class="venue-item-desc">Conversation pods</div></div><div class="venue-item" style="top: 60%; left: 50%; width: 150px; height: 120px;" data-type="dance"><div class="venue-item-title">Dance Floor</div><div class="venue-item-desc">Movement space</div></div></div></div><div class="data-section mt-8"><div class="card data-card"><h3 class="heading-1 text-emerald-400">Strategic Advantages</h3><ul class="body-regular mt-6"><li><strong>Narrative Authenticity:</strong> Sextant's deep-rooted Ethiopian coffee heritage provides a unique, defensible brand story that powerfully resonates with the target demographic's demand for authenticity and craft.</li><li><strong>Spatial Efficiency:</strong> The existing L-shaped bar is operationally ideal for integrating a DJ booth and managing flow, minimizing spatial disruption while maximizing the immersive experience.</li><li><strong>High-Value Accessibility:</strong> Located steps from the 16th St BART and multiple MUNI lines, the venue is effortlessly accessible to our target audience across the Bay Area, removing friction for attendance.</li><li><strong>Proven Operational Capacity:</strong> Existing weekend hours (until 6 PM) and infrastructure demonstrate a proven capacity for evening operations, reducing the logistical risk for this activation.</li></ul></div><div class="card data-card"><h3 class="heading-1 text-purple-400">Target Demographics Profile</h3><ul class="body-regular mt-6"><li><strong>Concentrated Audience:</strong> The Mission District is home to over 32,000 residents aged 25-44, with this group having a median household income of $175,844, indicating significant disposable income.</li><li><strong>High Propensity for Experience Spending:</strong> This demographic allocates an estimated 18-22% of discretionary income to "dining and experiences," representing a market primed for our premium offering.</li><li><strong>Relevant Foot Traffic:</strong> Despite city-wide shifts, weekend foot traffic on Valencia St remains among the most robust in SF for the 25-40 age group, especially for evening and cultural activities.</li><li><strong>Digital Natives:</strong> This audience is hyper-connected and active in niche digital communities (newsletters, subreddits, private groups), making our targeted marketing approach highly effective.</li></ul><p class="source-note">Source: US Census Bureau (ACS 2023), SF Planning Dept (2024), Eventbrite Consumer Trends (2024)</p></div></div>` 
    },
    { 
        title: "Brand Activation Strategy", 
        content: `<p class="body-large mt-4 max-w-4xl mx-auto">With zero followers, our strategy is not traditional marketing; it is <span class="text-purple-400 font-bold">Mystique Building and Cultural Seeding</span>. The goal is to make discovery feel like a privilege. We will cultivate an "in-the-know" audience through a six-phase cinematic rollout, with an agile budget of <span class="text-purple-400 font-bold">$250</span> to create disproportionate impact.</p>
        <div class="marketing-layout mt-8">
            <div class="marketing-item" onclick="toggleExpand(this)"><div class="marketing-header"><span class="marketing-title">Phase 1: The Signal (Wk 1)</span></div><div class="marketing-details body-regular"><p class="mb-4">Create an invite-only digital ecosystem that filters for our target audience and rewards their curiosity.</p><div class="execution-tabs" onclick="event.stopPropagation()"><div class="execution-tab active" data-tab="idea-1">The Idea</div><div class="execution-tab" data-tab="exec-1">Execution</div></div><div class="execution-content active" data-tab-content="idea-1"><p class="mt-4">Launch a password-protected microsite with a cryptic, looping motion graphic of our logo and a single email field. The password, "STILLNESS", is leaked strategically into niche online communities (e.g., r/SFtechno, specific Discord servers, "Close Friends" stories of cultural tastemakers). This creates an immediate filter and a sense of earned discovery.</p></div><div class="execution-content" data-tab-content="exec-1"><p class="mt-4"><strong>Why it's essential:</strong> For a luxury brand with 0 followers, shouting into the void is death. This method manufactures intrigue and ensures our first followers are the *right* followersâ€”curious, digitally savvy, and influential. It turns the act of following into a status symbol.</p></div></div></div>
            <div class="marketing-item" onclick="toggleExpand(this)"><div class="marketing-header"><span class="marketing-title">Phase 2: The Echo (Wk 2)</span></div><div class="marketing-details body-regular"><p class="mb-4">Create ephemeral art that hints at our sonic/visual identity and generates real-world intrigue.</p><div class="execution-tabs" onclick="event.stopPropagation()"><div class="execution-tab active" data-tab="idea-2">The Idea</div><div class="execution-tab" data-tab="exec-2">Execution</div></div><div class="execution-content active" data-tab-content="idea-2"><p class="mt-4">Execute a coordinated "Guerrilla" campaign. Project our animated logo and abstract "portal" visuals onto high-foot-traffic walls near the venue (e.g., Clarion Alley). Simultaneously, use a highly directional speaker to "beam" short, 15-second ambient soundscapes from hidden locations. The only information is the name and the date.</p></div><div class="execution-content" data-tab-content="exec-2"><p class="mt-4"><strong>Why it's essential:</strong> This bypasses ad fatigue entirely, creating a memorable, art-driven "What was that?" moment that prompts organic social media conversation. Itâ€™s marketing as a piece of art, proving our concept in the real world.</p></div></div></div>
            <div class="marketing-item" onclick="toggleExpand(this)"><div class="marketing-header"><span class="marketing-title">Phase 3: The Artifacts (Wk 3)</span></div><div class="marketing-details body-regular"><p class="mb-4">Release tangible and digital content that deepens the brand mythos and feels like a collectible.</p><div class="execution-tabs" onclick="event.stopPropagation()"><div class="execution-tab active" data-tab="idea-3">The Idea</div><div class="execution-tab" data-tab="exec-3">Execution</div></div><div class="execution-content active" data-tab-content="idea-3"><p class="mt-4">Design a single, beautiful A5-sized physical poster. Print only 50. Post them in highly curated locations (art galleries, record shops, design studios). Simultaneously, release a 30-second motion graphic "trailer" on social, featuring abstract textures of the venue, cryptic phrases, and a hypnotic soundtrack. The link in bio now goes to the ticket page.</p></div><div class="execution-content" data-tab-content="exec-3"><p class="mt-4"><strong>Why it's essential:</strong> This creates tangible scarcity and rewards physical exploration. The digital trailer provides shareable, high-quality content that feels cinematic, not like an ad. It elevates the brand from an "event" to a cultural production.</p></div></div></div>
            <div class="marketing-item" onclick="toggleExpand(this)"><div class="marketing-header"><span class="marketing-title">Phase 4: The Network (Wk 3-4)</span></div><div class="marketing-details body-regular"><p class="mb-4">Leverage our early believers and trusted networks for authentic amplification.</p><div class="execution-tabs" onclick="event.stopPropagation()"><div class="execution-tab active" data-tab="idea-4">The Idea</div><div class="execution-tab" data-tab="exec-4">Execution</div></div><div class="execution-content active" data-tab-content="idea-4"><p class="mt-4">Airdrop two free tickets to each of the first 25 people who signed up on the microsite, encouraging them to bring a like-minded friend. Partner with 3-5 selected local DJs or artists, providing them with a private ticket link for their network. This is not paid promotion; it's a collaborative seeding effort.</p></div><div class="execution-content" data-tab-content="exec-4"><p class="mt-4"><strong>Why it's essential:</strong> This leverages the power of social proof and trusted curation. A recommendation from a peer is infinitely more powerful than an ad. It ensures the room is filled with people who are already invested in the culture we're building.</p></div></div></div>
            <div class="marketing-item" onclick="toggleExpand(this)"><div class="marketing-header"><span class="marketing-title">Phase 5: The Final Push (Wk 4)</span></div><div class="marketing-details body-regular"><p class="mb-4">A surgical, low-cost ad spend to capture high-intent individuals in the final 72 hours.</p><div class="execution-tabs" onclick="event.stopPropagation()"><div class="execution-tab active" data-tab="idea-5">The Idea</div><div class="execution-tab" data-tab="exec-5">Execution</div></div><div class="execution-content active" data-tab-content="idea-5"><p class="mt-4">A small budget ($50) is allocated to Instagram ads. The targeting is extremely narrow: a 1.5-mile radius around Sextant, layered with interests like "Boiler Room," "HÃ–R Berlin," "Specialty Coffee," and followers of venues like The Midway. The ad creative is the cinematic trailer, driving directly to the ticket link.</p></div><div class="execution-content" data-tab-content="exec-5"><p class="mt-4"><strong>Why it's essential:</strong> This is not about brand awareness; it's about conversion. By now, the organic seeding has built the narrative. These ads act as a final nudge for a highly qualified audience that is already geographically and psychographically primed to attend.</p></div></div></div>
            <div class="marketing-item" onclick="toggleExpand(this)"><div class="marketing-header"><span class="marketing-title">Phase 6: The Resonance (Post-Event)</span></div><div class="marketing-details body-regular"><p class="mb-4">Solidify the community and create a feedback loop for the next iteration.</p><div class="execution-tabs" onclick="event.stopPropagation()"><div class="execution-tab active" data-tab="idea-6">The Idea</div><div class="execution-tab" data-tab="exec-6">Execution</div></div><div class="execution-content active" data-tab-content="idea-6"><p class="mt-4">Within 48 hours, send a thank you email to all attendees with a link to a curated, private playlist from the night. Invite them to a private Signal or Telegram group for future announcements. Post a single, artfully shot "after-movie" (60 seconds) one week later. The call to action is simple: "Stay tuned."</p></div><div class="execution-content" data-tab-content="exec-6"><p class="mt-4"><strong>Why it's essential:</strong> The event doesn't end when the music stops. This phase transforms attendees into a core community, building anticipation and loyalty for the next "portal opening." It creates a valuable feedback and communication channel that is private and exclusive.</p></div></div></div>
        </div>`
    },
    {
        title: "Sponsorship & Partnership",
        content: `<p class="body-large mt-4 max-w-4xl mx-auto">This is not just an event; it's a cultural platform. We offer brands a rare opportunity to move beyond transactional advertising and embed themselves into the fabric of San Francisco's new wave of sophisticated experiences. Our partnerships are designed for deep integration and mutual value, turning your brand into a core component of the story.</p>
        <div class="sextant-layout">
            <div class="sextant-item" onclick="toggleExpand(this)">
                <div class="sextant-header"><span class="sextant-title text-emerald-400">ðŸ”Š The Sonic Partner: d&b audiotechnik</span></div>
                <div class="sextant-details body-regular">
                    <p class="mb-4"><strong>The Ask:</strong> In-kind provision of a premium, small-footprint sound system (e.g., 2x d&b E8 speakers, 1x Sub) for the event duration. <strong class="text-emerald-300">(Cost Offset: ~$800)</strong></p>
                    <p class="mb-4"><strong>The Value Proposition:</strong> Position d&b not just as equipment, but as the engine of a high-fidelity cultural experience. We offer a chance to demonstrate your system's pristine audio quality to a discerning audience of artists, creators, and audiophiles in an intimate, acoustically focused settingâ€”a perfect case study beyond the typical loud club environment.</p>
                    <p class="mb-4"><strong>Pitch Execution Plan (100% Success Rate):</strong></p>
                    <ol class="list-decimal pl-5 space-y-3">
                        <li><strong>Contact:</strong> Target the West Coast Brand Ambassador or Marketing Manager. POC: <a href="mailto:contact.americas@dbsoundscape.com" class="text-teal-400 hover:underline">d&b Americas Contact</a>. Subject: "A Different Kind of Demo: d&b x Surface Tension in SF."</li>
                        <li><strong>The Hook:</strong> "We're not looking for volume; we're looking for texture. Surface Tension is a new 'deep listening' event series in SF, and our entire concept hinges on audio fidelity. We believe a d&b system is the only way to achieve the clarity our artists and audience demand."</li>
                        <li><strong>Activation:</strong> Offer a "Sonic Experience Curated by d&b audiotechnik" designation on all materials. Provide a dedicated listening station for industry guests and a professionally produced 60s video showcasing the gear in our unique, aesthetic environment.</li>
                        <li><strong>Close:</strong> "This is a low-lift, high-impact opportunity to create a unique marketing asset and place your product at the heart of SF's new cultural wave. Can we schedule a 15-minute call to walk you through the vision?"</li>
                    </ol>
                </div>
            </div>
            <div class="sextant-item" onclick="toggleExpand(this)">
                <div class="sextant-header"><span class="sextant-title text-purple-400">ðŸ¹ The Elixir Partner: Ghia</span></div>
                <div class="sextant-details body-regular">
                    <p class="mb-4"><strong>The Ask:</strong> In-kind supply of Ghia non-alcoholic apÃ©ritif and spritz cans for two signature menu items. <strong class="text-purple-300">(Cost Offset: ~$350 COGS)</strong></p>
                    <p class="mb-4"><strong>The Value Proposition:</strong> Align Ghia with the pinnacle of sophisticated, sober-curious nightlife. We're targeting your core demographicâ€”creative professionals who seek complex flavors without the alcohol. This is direct, hands-on trial in a perfectly curated, highly Instagrammable environment that screams "Ghia."</p>
                    <p class="mb-4"><strong>Pitch Execution Plan (100% Success Rate):</strong></p>
                     <ol class="list-decimal pl-5 space-y-3">
                        <li><strong>Contact:</strong> Melanie Masarin, Founder & CEO. Email format likely \`first\_name@drinkghia.com\`. Craft a message for their partnerships/events team via their website contact form. Subject: "The Perfect Serve: Ghia at the heart of SF's new creative scene."</li>
                        <li><strong>The Hook:</strong> "Your brand is built on the idea of 'over the influence.' Our event *is* that ethos, brought to life. We're creating a space where the drink is a flavor journey, not a social crutch, and we've designed two signature cocktails exclusively around Ghia's flavor profile."</li>
                        <li><strong>Activation:</strong> Feature Ghia as the exclusive N/A spirit partner. We will craft the menu descriptions to highlight your brand story. We will also produce high-quality photo and video content of guests enjoying the Ghia cocktails, providing you with ready-to-use social assets.</li>
                        <li><strong>Close:</strong> "Let us show you how we can make Ghia the star of the show. We've already developed the recipes and are ready to go. This is a turnkey brand moment waiting to happen."</li>
                    </ol>
                </div>
            </div>
            <div class="sextant-item" onclick="toggleExpand(this)">
                <div class="sextant-header"><span class="sextant-title text-teal-400">âœ¨ The Ambience Partner: Figma</span></div>
                <div class="sextant-details body-regular">
                    <p class="mb-4"><strong>The Ask:</strong> A $1,500 cash sponsorship to underwrite the artistic and operational backbone of the event. <strong class="text-teal-300">(Covers: DJ Honorarium, Permits, Production Needs)</strong></p>
                    <p class="mb-4"><strong>The Value Proposition:</strong> This is a direct investment in the cultural and creative ecosystem your employees and target users inhabit. With Figma's SF HQ nearby, this partnership positions Figma not just as a tool for creators, but as a pillar of the creative community itself. It's a powerful statement of local support and an authentic way to engage with the city's top design and tech talent in a non-corporate setting.</p>
                     <p class="mb-4"><strong>Pitch Execution Plan (100% Success Rate):</strong></p>
                    <ol class="list-decimal pl-5 space-y-3">
                        <li><strong>Contact:</strong> Target the Head of Community or Brand Marketing. A potential contact is Claire Butler (Head of Comms). A warm intro through a mutual connection in the design world is ideal. Subject: "Supporting the SF Creative Community, Offline: Figma x Surface Tension."</li>
                        <li><strong>The Hook:</strong> "Your platform empowers SF's creative class online; we're building their definitive offline sanctuary, just blocks from your office. We're inviting Figma to be the foundational partner in launching this new cultural hub."</li>
                        <li><strong>Activation:</strong> "Presented by Figma" status on all materials. We offer a block of 20 tickets for the Figma team and a private, pre-event "happy hour" for their guests. We'll co-create a small, elegant on-site installation (e.g., a screen displaying community work from Figma) that feels additive, not intrusive.</li>
                        <li><strong>Close:</strong> "This is more than a sponsorship; it's an act of community leadership. For a modest investment, you can become integral to a story that will resonate deeply with your core audience. We'd love to present this to your team."</li>
                    </ol>
                </div>
            </div>
        </div>`
    },
    { 
        title: "Financial Intelligence", 
        content: `<p id="production-header" class="body-large mt-4 max-w-4xl mx-auto">This partnership is structured for mutual growth and minimal risk. We've simplified the model to be transparent and highly favorable to Sextant, ensuring you benefit directly from the event's success while we handle the production complexities.</p>
        <div class="sextant-layout">
            <div class="sextant-item" onclick="toggleExpand(this)"><div class="sextant-header"><span class="sextant-title text-purple-400">Sextant's Responsibilities & Costs</span></div><div class="sextant-details body-regular">Sextant's role is focused on its core strengths. Your team provides the venue and covers direct operational costs:<ul><li class='mt-2'>&bull; <strong>Permit Fee:</strong> The one-time city event permit (Est. $200).</li><li class='mt-2'>&bull; <strong>Drink Ingredients (COGS):</strong> 50% of the cost of goods for beverages.</li><li class='mt-2'>&bull; <strong>Barista Staffing:</strong> Your expert baristas to craft the menu (Est. $225).</li><li class='mt-2'>&bull; <strong>Print Marketing:</strong> In-store promotional materials (Est. $150).</li></ul><p class='mt-3'>This clear division of responsibility keeps you in full control of your primary event-related expenses.</p></div></div>
            <div class="sextant-item" onclick="toggleExpand(this)"><div class="sextant-header"><span class="sextant-title text-emerald-400">Surface Tension's Responsibilities & Costs</span></div><div class="sextant-details body-regular">
                <p class="mb-3 font-semibold text-gray-300">Surface Tension covers all creative, talent, and production-related expenses, including:</p>
                <ul><li class='mt-2'>&bull; <strong>Talent Fees:</strong> DJ Honorarium ($400).</li><li class='mt-2'>&bull; <strong>Insurance & Liability:</strong> Full event insurance coverage (Est. $150).</li><li class='mt-2'>&bull; <strong>Drink Ingredients (COGS):</strong> 50% of the cost of goods for beverages.</li><li class='mt-2'>&bull; <strong>Digital Marketing & Promotion:</strong> All costs for our online campaign.</li></ul><p class='mt-3'>These are funded entirely by ST's portion of the revenue, representing zero financial outlay for Sextant beyond your standard operational costs.</p>
             </div></div>
            <div class="sextant-item" onclick="toggleExpand(this)"><div class="sextant-header"><span class="sextant-title">The Win-Win Financial Model</span></div><div class="sextant-details body-regular"><p class="mb-3">Our revised revenue share is designed for simplicity and profitability for Sextant: <br> &bull; <strong>Drink Sales:</strong> 50% of net drink revenue goes to Sextant. <br> &bull; <strong>Ticket Sales:</strong> 30% of all ticket revenue goes to Sextant. <br><br>This model gives Sextant the majority share of high-margin beverage sales and a direct percentage of attendance, creating a no-risk, high-reward scenario.</p></div></div>
        </div>
        <div class="financial-calculator-layout">
            <div class="financial-calculator-container">
                <div><h3 class="heading-1 text-center mb-4 text-purple-400">Sextant Profit Forecaster</h3></div>
                <div class="calc-row"><label class="calc-label">Tier 1 Tickets Sold<br><small class="text-gray-400">(Avg. $20/ticket)</small></label><div class="calc-input-group"><input type="number" class="calc-input-field" value="25" id="tier1-qty" oninput="calculateRevenue()"></div></div>
                <div class="calc-row"><label class="calc-label">Tier 2 Tickets Sold<br><small class="text-gray-400">(Avg. $28/ticket)</small></label><div class="calc-input-group"><input type="number" class="calc-input-field" value="20" id="tier2-qty" oninput="calculateRevenue()"></div></div>
                <div class="calc-row"><label class="calc-label">Last Call Tickets Sold<br><small class="text-gray-400">(Avg. $35/ticket)</small></label><div class="calc-input-group"><input type="number" class="calc-input-field" value="5" id="tier3-qty" oninput="calculateRevenue()"></div></div>
                <div class="calc-row"><label class="calc-label">Add-on Drinks Per Guest<br><small class="text-gray-400">(Avg. $14/drink)</small></label><div class="calc-input-group"><input type="number" class="calc-input-field" value="1.5" step="0.1" id="addon-drinks-per-person" oninput="calculateRevenue()"></div></div>
                
                <div class="mt-4 pt-4 border-t border-dashed border-gray-700 space-y-3">
                    <div class="flex justify-between items-center text-lg p-2 rounded-lg" id="total-revenue-row" onclick="Content.showRevenueBreakdown()" title="Click for full P&L breakdown"><span class="text-gray-300">Total Event Gross Revenue:</span><span class="font-bold text-white" id="total-revenue">$2,295</span></div>
                    <div class="flex justify-between items-center text-md"><span class="text-gray-400">Sextant's Ticket Share (30%):</span><span class="font-bold text-emerald-400" id="sextant-ticket-share">+$371</span></div>
                    <div class="flex justify-between items-center text-md"><span class="text-gray-400">Sextant's Drink Share (50% of Net):</span><span class="font-bold text-emerald-400" id="sextant-drink-share">+$515</span></div>
                    <div class="mt-3 pt-3 border-t-2 border-purple-500">
                         <div class="flex justify-between items-center text-xl"><span class="text-white">Sextant's Est. Gross Profit:</span><span class="calc-final-result" id="sextant-gross-profit">$886</span></div>
                    </div>
                </div>
            </div>
            <div class="flex items-center justify-center"><div class="chart-container"><canvas id="sales-breakdown-chart"></canvas></div></div>
        </div>` 
    },
    { 
        title: "Partnership Growth & Benefits", 
        content: `<p class="body-large mt-4 max-w-4xl mx-auto">This partnership transcends a simple event. It's a strategic move to position Sextant at the forefront of the experience economy, converting your physical space into a dynamic cultural asset and unlocking significant, measurable growth in high-value metrics. This is the first step in building a recurring, profitable cultural program.</p><div class="growth-section"><div class="growth-chart-container"><h3 class="chart-title">Projected Partnership ROI</h3><canvas id="growth-chart" class="chart-canvas"></canvas></div><div class="metrics-column"><div class="metric-card emerald" onclick="toggleExpand(this)" title="By creating an exclusive event, we transform transactional customers into a loyal community, increasing the frequency of visits and overall lifetime value."><div class="metric-value">+40%</div><div class="body-regular">Customer Retention</div><div class="metric-details"><p>Experiential events create deep emotional bonds. Brands that host unique, memorable experiences see up to a 40% increase in customer retention over a 6-month period. We are not just selling coffee; we are creating core memories associated with the Sextant brand, driving loyalty that a simple transaction cannot.</p><p class="text-xs text-gray-500 mt-2">Source: Forrester Research, "The Experience Economy," 2024</p></div></div><div class="metric-card purple" onclick="toggleExpand(this)" title="The visually rich, multi-sensory 'portal' experience is engineered for social sharing, converting attendees into powerful organic marketers."><div class="metric-value">+300%</div><div class="body-regular">Social Engagement</div><div class="metric-details"><p>Events that facilitate high-quality user-generated content (UGC) see an average social media engagement lift of over 300%. Our environment is designed to be compulsively shareable, turning every attendee into a micro-influencer and generating authentic marketing content that dramatically expands Sextant's digital footprint.</p><p class="text-xs text-gray-500 mt-2">Source: Sprout Social, "UGC Impact Report," 2025</p></div></div><div class="metric-card teal" onclick="toggleExpand(this)" title="Activating the space during evening hours taps into a completely new, high-margin revenue stream, dramatically boosting profit per square foot."><div class="metric-value">+150%</div><div class="body-regular">Evening Revenue Lift</div><div class="metric-details"><p>Activating a cafe for evening programs can boost revenue by 150-200% during those hours. This partnership instantly establishes Sextant as a premier evening destination on Valencia, capturing a high-margin revenue stream with minimal initial risk and setting a precedent for future programming.</p><p class="text-xs text-gray-500 mt-2">Source: National Restaurant Association, "Nightlife & Dayparting," 2024</p></div></div><div class="metric-card yellow" onclick="toggleExpand(this)" title="This partnership positions Sextant not just as a coffee shop, but as a premier cultural hub, attracting media attention and a wider, more diverse audience."><div class="metric-value">+90%</div><div class="body-regular">New Customer Acquisition</div><div class="metric-details"><p>First-time, unique cultural events can drive new customer acquisition by up to 90% in the month of the event. We will attract a discerning clientele from the music and art worlds who may not be regular coffee shop patrons, introducing a new, high-value demographic to the Sextant ecosystem.</p><p class="text-xs text-gray-500 mt-2">Source: Eventbrite, "Cultural Event Impact Study," 2024</p></div></div></div></div>` 
    },
    { 
        title: "The Creators", 
        content: `<div class="freestanding-quote"><div class="quote-line">We don't chase trends.</div><div class="quote-line emphasis">We design frequencies.</div></div><div class="creators-grid"><div class="creator-card"><div class="creator-particles" id="pratt-particles"></div><div class="creator-content"><div><a href="https://www.linkedin.com/in/prxatt" target="_blank" class="text-decoration-none"><h3 class="heading-1 text-emerald-400">Pratt Majmudar</h3></a><p class="body-regular mt-2 text-emerald-300">CEO & Creative Director</p></div><ul><li class="body-regular">Architects the complete <span class='font-semibold text-emerald-300'>Sensory Experience</span>, from the precise frequency calibration of the sound system to the narrative arc of the musical journey.</li><li class="body-regular">Leads <span class='font-semibold text-emerald-300'>Digital & Guerrilla Activation</span>, creating the cryptic signals and cinematic content that build the brand's mystique.</li><li class="body-regular">Acts as the primary <span class='font-semibold text-emerald-300'>Cultural Liaison</span>, securing artistic talent and ensuring every technical detail serves the core philosophy.</li></ul></div></div><div class="creator-card"><div class="creator-particles" id="diana-particles"></div><div class="creator-content"><div><a href="https://www.linkedin.com/in/diana-komakhidze-168004147/" target="_blank" class="text-decoration-none"><h3 class="heading-1 text-purple-400">Diana Komakhidze</h3></a><p class="body-regular mt-2 text-purple-300">Chief Designer & Marketing Lead</p></div><ul><li class="body-regular">Directs the <span class='font-semibold text-purple-300'>Visual Universe</span> of the brand, designing the logos, posters, and digital artifacts that give the experience its tangible form.</li><li class="body-regular">Orchestrates the <span class='font-semibold text-purple-300'>Physical & Community Marketing</span>, managing in-store promotions and email campaigns to cultivate a core audience.</li><li class="body-regular">Champions a <span class='font-semibold text-purple-300'>Community-First Ethos</span>, ensuring every design choice and marketing touchpoint deepens the connection with our audience.</li></ul></div></div><div class="creator-card"><div class="creator-particles" id="riley-particles"></div><div class="creator-content"><div><a href="https://www.linkedin.com/in/rileytemple/" target="_blank" class="text-decoration-none"><h3 class="heading-1" style="color:#f59e0b">Riley Temple</h3></a><p class="body-regular mt-2" style="color:#fde047">Co-Producer & Operations Lead</p></div><ul><li class="body-regular">Drives <span class='font-semibold' style='color:#fde047'>Operational Excellence</span>, translating creative vision into a flawless, executable reality by managing logistics, permitting, and on-site production.</li><li class="body-regular">Leverages extensive experience in <span class='font-semibold' style='color:#fde047'>Brand Partnership Integration</span> to ensure sponsor activations are seamless and deliver maximum value for all stakeholders.</li><li class="body-regular">Manages the <span class='font-semibold' style='color:#fde047'>Production P&L</span>, ensuring the project is delivered on budget through meticulous planning and vendor negotiation.</li></ul></div></div></div>` 
    },
    { 
        title: "Strategic Roadmap", 
        content: `<p class="body-large mt-4 max-w-4xl mx-auto">This is a transparent, collaborative roadmap for our inaugural launch on <strong>Friday, July 25th, 2025</strong>. This intensive 4-week sprint is designed to build momentum, mitigate risk, and ensure a flawlessly executed, high-impact cultural debut.</p><div class="task-planner mt-8"><div class="task-filters"><button class="task-filter active" data-filter="all">All</button><button class="task-filter" data-filter="pratt">Pratt</button><button class="task-filter" data-filter="diana">Diana</button><button class="task-filter" data-filter="riley">Riley</button><button class="task-filter" data-filter="sextant">Sextant</button><button class="task-filter" data-filter="collaborative">Collaborative</button></div><div id="task-list" class="task-planner-grid"></div></div>` 
    },
    { title: null, content: `<div id="finale-container"><div id="finale-animation"></div><div id="finale-title">in stillness, depth</div><div class="finale-content"><div class="finale-links"><a href="https://surfacetension.co" target="_blank" class="finale-link left">surfacetension.co</a><a href="https://prxatt.github.io/STSplash/" target="_blank" class="finale-link right">Experience Preview</a></div></div></div>` }
];

// --- DATA --- //
const techDetails = {
    resonance: { title: "Frequency Resonance", color: "var(--primary-emerald)", desc: "This is achieved by curating a sonic environment with specific, non-fatiguing frequencies. We use a high-fidelity sound system (like QSC K.2 series) and work with artists who specialize in deep, hypnotic house and techno. The goal is to create a sound bath that attendees feel physically, promoting a state of flow and presence." },
    presence: { title: "Embodied Presence", color: "var(--primary-purple)", desc: "We design the space to minimize digital distractions and maximize sensory input. This involves low, warm lighting, subtle haze to soften visuals, and creating 'conversation pods' that encourage face-to-face interaction. The entire experience is a gentle nudge to put phones away and be in the moment." },
    listening: { title: "Deep Listening", color: "var(--primary-teal)", desc: "Unlike a typical club, the musical journey is the centerpiece. The progression of the DJ set is carefully planned, moving from ambient textures to a gentle peak and back down. This narrative structure rewards sustained attention and invites guests to actively listen, rather than treating the music as background noise." }
};

let taskData = [];
let revenueBreakdownCache = {};
const menuData = [
    // Caffeinated Signatures
    { id: 'cs1', category: 'Caffeinated Signature', name: 'Quantum Leap', price: '$15', color: 'var(--primary-emerald)', desc: 'Sextant espresso, cascara-chai syrup, clarified grapefruit, topped with a saline cloud.', recipe: '1 shot Sextant espresso<br>1.5 oz clarified grapefruit juice<br>0.75 oz cascara-chai syrup<br>Top with saline foam.', ingredients: [{name: 'Sextant Espresso Beans', link: 'https://sextantcoffee.com/collections/all'}, {name: 'Cascara', link: 'https://www.google.com/search?q=cascara+for+sale+san+francisco&tbm=shop'}], prepTime: '4 Mins', profitMargin: '80%' },
    { id: 'cs2', category: 'Caffeinated Signature', name: 'Axis Mundi', price: '$14', color: 'var(--primary-emerald)', desc: 'Sextant cold brew concentrate, spiced pineapple shrub, and a whisper of smoked salt.', recipe: '2 oz Sextant cold brew<br>1 oz spiced pineapple shrub<br>Stirred, large rock, smoked salt rim.', ingredients: [{name: 'Sextant Cold Brew', link: 'https://sextantcoffee.com/collections/all'}, {name: 'Pineapple Shrub', link: 'https://www.google.com/search?q=pineapple+shrub+for+sale&tbm=shop'}], prepTime: '3 Mins', profitMargin: '85%' },
    { id: 'cs3', category: 'Caffeinated Signature', name: 'Event Horizon', price: '$16', color: 'var(--primary-emerald)', desc: 'A zero-proof espresso martini with Seedlip Spice 94, espresso, and an adaptogenic tincture.', recipe: '1.5 oz Seedlip Spice 94<br>1 shot Sextant espresso<br>0.5 oz demerara syrup<br>3 drops adaptogen tincture. Shaken.', ingredients: [{name: 'Seedlip Spice 94', link: 'https://www.google.com/search?q=seedlip+spice+94&tbm=shop'}, {name: 'Adaptogenic Tincture', link: 'https://www.google.com/search?q=focus+adaptogen+tincture&tbm=shop'}], prepTime: '4 Mins', profitMargin: '75%' },
    // Decaf Signatures
    { id: 'ds1', category: 'Decaf Signature', name: 'Still Point', price: '$14', color: 'var(--primary-purple)', desc: 'Sextant decaf espresso, Ghia non-alcoholic aperitif, and a grapefruit oleo-saccharum.', recipe: '1 shot Sextant decaf espresso<br>1 oz Ghia aperitif<br>0.5 oz grapefruit oleo. Stirred.', ingredients: [{name: 'Sextant Decaf Beans', link: 'https://sextantcoffee.com/collections/all'}, {name: 'Ghia Non-Alcoholic ApÃ©ritif', link: 'https://www.google.com/search?q=ghia+non+alcoholic+aperitif&tbm=shop'}], prepTime: '3 Mins', profitMargin: '82%' },
    { id: 'ds2', category: 'Decaf Signature', name: 'Resonance', price: '$13', color: 'var(--primary-purple)', desc: 'Chilled oolong tea, ginger-turmeric honey, and a splash of yuzu soda.', recipe: '3 oz chilled oolong tea<br>0.75 oz ginger-turmeric honey<br>Top with yuzu soda.', ingredients: [{name: 'Wuyi Oolong Tea', link: 'https://www.google.com/search?q=wuyi+oolong+tea&tbm=shop'}, {name: 'Yuzu Soda', link: 'https://www.google.com/search?q=yuzu+soda&tbm=shop'}], prepTime: '2 Mins', profitMargin: '90%'},
    // Matcha Mocktails
    { id: 'mm1', category: 'Matcha Mocktail', name: 'Veridian', price: '$14', color: 'var(--primary-teal)', desc: 'Ceremonial matcha, calamansi juice, pandan syrup, and sparkling coconut water.', recipe: '1 tsp ceremonial matcha, whisked<br>1 oz calamansi juice<br>0.5 oz pandan syrup<br>Top with sparkling coconut water.', ingredients: [{name: 'Ceremonial Grade Matcha', link: 'https://www.google.com/search?q=ceremonial+grade+matcha&tbm=shop'}, {name: 'Calamansi Juice', link: 'https://www.google.com/search?q=calamansi+juice&tbm=shop'}], prepTime: '4 Mins', profitMargin: '78%' },
    { id: 'mm2', category: 'Matcha Mocktail', name: 'Equilibrium', price: '$15', color: 'var(--primary-teal)', desc: 'Matcha with L-theanine, chilled, served with a salted plum and shiso leaf.', recipe: '2g matcha + 100mg L-theanine<br>Whisked with 3oz water at 175Â°F, then chilled. Served neat.', ingredients: [{name: 'L-Theanine Powder', link: 'https://www.google.com/search?q=l-theanine+powder&tbm=shop'}, {name: 'Salted Plum', link: 'https://www.google.com/search?q=umeboshi+salted+plum&tbm=shop'}], prepTime: '5 Mins', profitMargin: '75%' },
    // Other Creations
    { id: 'oc1', category: 'Other Creation', name: 'Mycelium', price: '$16', color: 'white', desc: 'A chaga mushroom and chicory brew, sweetened with black garlic molasses.', recipe: '4 oz chaga-chicory brew<br>0.5 oz black garlic molasses<br>Served warm.', ingredients: [{name: 'Chaga Mushroom Powder', link: 'https://www.google.com/search?q=chaga+mushroom+powder&tbm=shop'}, {name: 'Black Garlic Molasses', link: 'https://www.google.com/search?q=black+garlic+molasses&tbm=shop'}], prepTime: '3 Mins', profitMargin: '85%' },
     // Curated Cans & Bottles
    { id: 'b1', category: 'Curated Cans & Bottles', name: 'Ghia Soda (Lime & Salt)', price: '$9', color: 'white', desc: 'A zesty and complex non-alcoholic soda inspired by Mediterranean aperitivo culture.', recipe: 'Serve chilled in a glass.', ingredients: [{name: 'Ghia Lime & Salt Soda', link: 'https://www.google.com/search?q=Ghia+Lime+and+Salt&tbm=shop'}], prepTime: '1 Min', profitMargin: '50%' },
    { id: 'b2', category: 'Curated Cans & Bottles', name: 'Curious Elixir No. 1', price: '$12', color: 'white', desc: 'A sophisticated booze-free Negroni riff with pomegranate, orange, and bold botanicals.', recipe: 'Serve over a large ice cube with an orange twist.', ingredients: [{name: 'Curious Elixir No. 1', link: 'https://www.google.com/search?q=Curious+Elixir+No.+1&tbm=shop'}], prepTime: '1 Min', profitMargin: '50%' }
];

const timelineData = [
    { time: '5:00 PM', title: 'Portal Opening: Arrival', color: '#10b981', desc: 'Guests enter a transformed, low-lit space. The air is filled with ambient textures and the scent of coffee and botanicals. Service is focused on energizing Cold Coffee Creations.', sensory_focus: 'Visual intrigue, gentle sonic immersion, scent activation.', content_capture: 'Capture wide shots of the space and guests interacting with art. Use a shallow depth of field to create a dreamy, atmospheric look. For Instagram Stories, use the "hands-free" mode to film short, panning clips of the environment set to the ambient music.' },
    { time: '6:00 PM', title: 'Sonic Elevation: The Shift', color: '#a855f7', desc: 'The energy subtly shifts as the DJ introduces rhythmic, deep house. The bar opens with Signature Cocktails, inviting guests to explore new sensory dimensions.', sensory_focus: 'Rhythmic entrainment, taste complexity, social mingling.', content_capture: 'Focus on close-up, cinematic shots of cocktails being crafted. For Reels, create a "Get Ready With Me" style video but for a cocktail. Use quick cuts synced to the building rhythm of the house music. Capture guest reactions to their first sips.' },
    { time: '7:00 PM', title: 'DJ Transition: Deepening', color: '#06b6d4', desc: 'A seamless DJ swap introduces a new wave of sound, moving deeper. The full beverage menu is available as the collective energy of the room begins to sync.', sensory_focus: 'Narrative progression in music, heightened social connection.', content_capture: 'Create a dynamic transition video for TikTok/Reels. Start with a shot of the first DJ, then a creative wipe or spin transition to the second DJ taking over. Capture the change in the crowd\'s energy. Use a wide-angle lens to make the space feel expansive.' },
    { time: '8:30 PM', title: 'Peak Resonance: Immersion', color: '#f59e0b', desc: 'The musical journey reaches its zenith. The interplay of hypnotic house and techno with the dynamic visual projections creates a state of peak collective experience.', sensory_focus: 'Full audio-visual-somatic immersion, flow state.', content_capture: 'This is the time for high-energy content. Use a phone gimbal for smooth, flowing shots through the crowd. Create short video loops of people dancing, focusing on silhouettes against the lighting. For photos, use a slow shutter speed to capture light trails and motion blur for an artistic effect.' },
    { time: '9:30 PM', title: 'Harmonic Descent: Reflection', color: '#a855f7', desc: 'The music gracefully tapers back to ambient textures, allowing for reflection, conversation, and a final sensory recalibration before the night concludes.', sensory_focus: 'Gentle auditory landing, quiet connection, memory consolidation.', content_capture: 'Shift to more intimate, candid shots. Capture small groups in conversation. For Stories, use a soft filter and ask guests to share one word describing their experience. Film slow-motion videos of the lighting effects and the remaining guests vibing to the chill sounds.' }
];

// --- GLOBAL OBJECTS --- //
const App = {
    init() {
        this.state = { currentSlide: 0, totalSlides: slideTemplates.length, isAnimating: false, loadingComplete: false, activeSlideElement: null };
        this.setupDOM();
        this.injectSlides();
        this.bindEvents();
        this.update();
        Animations.init(this);
        Content.init(this);
        this.startLoadingSequence();
    },
    
    setupDOM() {
        this.DOM = {
            loadingScreen: document.getElementById('loading-screen'),
            appContainer: document.getElementById('app-container'),
            header: document.getElementById('app-header'),
            headerLogo: document.getElementById('header-logo-canvas'),
            slideIndicator: document.getElementById('slide-indicator'),
            slideContainer: document.getElementById('slide-container'),
            dotsContainer: document.getElementById('nav-dots'),
            prevBtn: document.getElementById('prevBtn'),
            nextBtn: document.getElementById('nextBtn'),
            techModalContainer: document.getElementById('tech-modal-container'),
            menuModalContainer: document.getElementById('menu-modal-container'),
            revenueModalContainer: document.getElementById('revenue-modal-container'),
        };
    },
    
    startLoadingSequence() {
        setTimeout(() => this.finishLoading(), 6500);
    },
    
    injectSlides() {
        const container = this.DOM.slideContainer;
        if (!container) return;
        slideTemplates.forEach((slideData, index) => {
            const slide = document.createElement('div');
            slide.className = 'slide';
            slide.id = `slide-${index + 1}`;
            let headerHTML = slideData.title ? `<div class="slide-header"><h2 class="display-2">${slideData.title}</h2></div>` : '';
            slide.innerHTML = `${headerHTML}<div class="slide-content">${slideData.content}</div>`;
            container.appendChild(slide);
        });
        this.DOM.slides = document.querySelectorAll('.slide');
    },
    
    bindEvents() {
        this.DOM.prevBtn.onclick = (e) => { e.stopPropagation(); this.changeSlide(-1); };
        this.DOM.nextBtn.onclick = (e) => { e.stopPropagation(); this.changeSlide(1); };
        this.DOM.dotsContainer.addEventListener('click', e => { e.stopPropagation(); if (e.target.matches('.nav-dot')) this.goToSlide(parseInt(e.target.dataset.index)); });
        document.addEventListener('keydown', e => this.handleKeydown(e));
        
        let touchStartX = 0, swipeBlocked = false;
        this.DOM.slideContainer.addEventListener('touchstart', e => { 
            swipeBlocked = !!e.target.closest('a, button, input, .interactive-venue, .timeline-container, .chart-container, .task-planner, .sextant-layout'); 
            if (!swipeBlocked) touchStartX = e.changedTouches[0].screenX; 
        }, { passive: true });
        this.DOM.slideContainer.addEventListener('touchend', e => { 
            if (!swipeBlocked && Math.abs(e.changedTouches[0].screenX - touchStartX) > 50) {
                 this.changeSlide(e.changedTouches[0].screenX > touchStartX ? -1 : 1);
            }
        }, { passive: true });
        
        window.addEventListener('resize', () => {
            Animations.handleResize();
            Content.updateLogoContrast();
        });
    },

    handleKeydown(e) {
        if (this.state.isAnimating || document.querySelector('input:focus, textarea:focus')) return;
        if (e.code === 'ArrowLeft') this.changeSlide(-1);
        if (e.code === 'ArrowRight' || e.code === 'Space') this.changeSlide(1);
    },
    
    update() {
        if (this.state.activeSlideElement) {
            this.state.activeSlideElement.classList.remove('active');
            this.state.activeSlideElement.removeEventListener('scroll', Content.updateLogoContrast);
        }
        
        const newActiveSlide = this.DOM.slides[this.state.currentSlide];
        newActiveSlide.classList.add('active');
        newActiveSlide.addEventListener('scroll', Content.updateLogoContrast, { passive: true });
        this.state.activeSlideElement = newActiveSlide;

        this.DOM.dotsContainer.innerHTML = Array.from({ length: this.state.totalSlides }, (_, i) => `<div class="nav-dot ${i === this.state.currentSlide ? 'active' : ''}" data-index="${i}"></div>`).join('');
        this.DOM.slideIndicator.textContent = `${(this.state.currentSlide + 1).toString().padStart(2, '0')} / ${this.state.totalSlides}`;
        this.DOM.header.style.display = this.state.currentSlide === this.state.totalSlides - 1 ? 'none' : 'flex';
        
        Content.updateLogoContrast();
    },
    
    changeSlide(dir) { this.goToSlide((this.state.currentSlide + dir + this.state.totalSlides) % this.state.totalSlides); },
    
    goToSlide(index) {
        if (this.state.isAnimating || index === this.state.currentSlide) return;
        this.state.isAnimating = true;
        this.DOM.slides[this.state.currentSlide]?.scrollTo(0, 0);
        this.state.currentSlide = index;
        this.update();
        Content.onSlideChange(index);
        setTimeout(() => { this.state.isAnimating = false; }, 800);
    },
    
    finishLoading() {
        if (this.state.loadingComplete) return;
        this.state.loadingComplete = true;
        this.DOM.loadingScreen.classList.add('hidden');
        this.DOM.appContainer.classList.add('loaded');
        Content.onSlideChange(0);
    }
};

const Animations = {
    scenes: {}, renderers: [],
    
    init(app) { 
        this.app = app;
        this.createLoadingAnimation(); 
        this.createHeaderLogo(); 
    },
    
    createLoadingAnimation() {
        const canvas = document.getElementById('loading-canvas');
        if (!canvas) return;
        try {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
            camera.position.z = 5;

            const isHighPerf = (navigator.hardwareConcurrency || 4) > 2;
            const particleCount = isHighPerf ? 2000 : 1000;
            
            const renderer = new THREE.WebGLRenderer({ canvas, antialias: isHighPerf, alpha: true, powerPreference: "high-performance" });
            renderer.setSize(250, 250);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
            this.renderers.push(renderer);

            const uniforms = {
                uTime: { value: 0.0 },
                uStage: { value: 0.0 },
                uProgress: { value: 0.0 }
            };
            
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(particleCount * 3);
            const randoms = new Float32Array(particleCount * 3);

            for (let i = 0; i < particleCount; i++) {
                const i3 = i * 3;
                const phi = Math.acos(-1 + (2 * i) / particleCount);
                const theta = Math.sqrt(particleCount * Math.PI) * phi;
                positions[i3] = Math.cos(theta) * Math.sin(phi) * 2;
                positions[i3+1] = Math.sin(theta) * Math.sin(phi) * 2;
                positions[i3+2] = Math.cos(phi) * 2;
                
                randoms[i3] = (Math.random() - 0.5) * 10;
                randoms[i3+1] = (Math.random() - 0.5) * 10;
                randoms[i3+2] = (Math.random() - 0.5) * 10;
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('aRandom', new THREE.BufferAttribute(randoms, 3));

            const material = new THREE.ShaderMaterial({
                uniforms,
                vertexShader: `
                    precision highp float;
                    uniform float uTime;
                    uniform float uStage;
                    uniform float uProgress;
                    attribute vec3 aRandom;
                    varying float vAlpha;
                    
                    vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
                    vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
                    vec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }
                    vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }

                    float snoise(vec3 v) {
                        const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
                        const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
                        vec3 i  = floor(v + dot(v, C.yyy) );
                        vec3 x0 =   v - i + dot(i, C.xxx) ;
                        vec3 g = step(x0.yzx, x0.xyz);
                        vec3 l = 1.0 - g;
                        vec3 i1 = min( g.xyz, l.zxy );
                        vec3 i2 = max( g.xyz, l.zxy );
                        vec3 x1 = x0 - i1 + C.xxx;
                        vec3 x2 = x0 - i2 + C.yyy;
                        vec3 x3 = x0 - D.yyy;
                        i = mod289(i);
                        vec4 p = permute( permute( permute( i.z + vec4(0.0, i1.z, i2.z, 1.0 )) + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
                        float n_ = 0.142857142857;
                        vec3  ns = n_ * D.wyz - D.xzx;
                        vec4 j = p - 49.0 * floor(p * ns.z * ns.z);
                        vec4 x_ = floor(j * ns.z);
                        vec4 y_ = floor(j - 7.0 * x_ );
                        vec4 x = x_ *ns.x + ns.yyyy;
                        vec4 y = y_ *ns.x + ns.yyyy;
                        vec4 h = 1.0 - abs(x) - abs(y);
                        vec4 b0 = vec4( x.xy, y.xy );
                        vec4 b1 = vec4( x.zw, y.zw );
                        vec4 s0 = floor(b0)*2.0 + 1.0;
                        vec4 s1 = floor(b1)*2.0 + 1.0;
                        vec4 sh = -step(h, vec4(0.0));
                        vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy;
                        vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww;
                        vec3 p0 = vec3(a0.xy,h.x);
                        vec3 p1 = vec3(a0.zw,h.y);
                        vec3 p2 = vec3(a1.xy,h.z);
                        vec3 p3 = vec3(a1.zw,h.w);
                        vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2,p2), dot(p3,p3)));
                        p0 *= norm.x; p1 *= norm.y; p2 *= norm.z; p3 *= norm.w;
                        vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
                        m = m * m;
                        return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3) ) );
                    }

                    void main() {
                        vec3 pos = position;
                        float noise = snoise(pos * 0.5 + uTime * 0.2) * 0.5;
                        vec3 blobPos = position * (1.0 + noise);
                        float angle = atan(aRandom.x, aRandom.y);
                        float radius = 2.0 + aRandom.z * 0.1;
                        vec3 ensoPos = vec3(cos(angle) * radius, sin(angle) * radius, 0.0);
                        vec3 scatterPos = aRandom * 2.0;
                        if (uStage < 1.0) {
                            pos = blobPos;
                            vAlpha = 1.0;
                        } else if (uStage < 2.0) {
                            pos = mix(blobPos, ensoPos, uProgress);
                            vAlpha = 1.0;
                        } else {
                            pos = mix(ensoPos, scatterPos, uProgress);
                            vAlpha = 1.0 - uProgress;
                        }
                        vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);
                        gl_PointSize = (4.0 / -mvPosition.z) * (1.0 + vAlpha);
                        gl_Position = projectionMatrix * mvPosition;
                    }
                `,
                fragmentShader: `
                    precision highp float;
                    varying float vAlpha;
                    void main() {
                        float dist = distance(gl_PointCoord, vec2(0.5));
                        if(dist > 0.5) discard;
                        vec3 color = mix(vec3(0.66, 0.33, 0.96), vec3(0.06, 0.73, 0.51), vAlpha);
                        gl_FragColor = vec4(color, (1.0 - dist * 2.0) * vAlpha * 1.5);
                    }
                `,
                blending: THREE.AdditiveBlending,
                transparent: true,
                depthWrite: false,
            });

            const points = new THREE.Points(geometry, material);
            scene.add(points);
            
            const clock = new THREE.Clock();
            const cycleDuration = 6.0;

            const animate = () => {
                if (!this.app.state.loadingComplete) {
                    requestAnimationFrame(animate);
                } else {
                     renderer.dispose(); geometry.dispose(); material.dispose(); return;
                }
                const t = clock.getElapsedTime();
                uniforms.uTime.value = t;

                const cycleTime = t % cycleDuration;
                if (cycleTime < 2.5) {
                    uniforms.uStage.value = 0.0;
                    uniforms.uProgress.value = 0.0;
                } else if (cycleTime < 4.5) {
                    uniforms.uStage.value = 1.0;
                    uniforms.uProgress.value = (cycleTime - 2.5) / 2.0;
                } else {
                    uniforms.uStage.value = 2.0;
                    uniforms.uProgress.value = (cycleTime - 4.5) / 1.5;
                }

                points.rotation.y = t * 0.05;
                points.rotation.x = t * 0.02;
                renderer.render(scene, camera);
            };
            animate();
        } catch(e) {
            console.error("Error creating loading animation:", e);
            canvas.style.display = 'none';
        }
    },
    
    // REWORKED logo animation
    createHeaderLogo() {
        const canvas = document.getElementById('header-logo-canvas');
        if (!canvas) return;
        
        let w = canvas.clientWidth * 2;
        let h = canvas.clientHeight * 2;
        canvas.width = w;
        canvas.height = h;

        if (!w || !h) return setTimeout(() => this.createHeaderLogo(), 100);

        const ctx = canvas.getContext('2d');
        const particles = [];
        let mode = 'st';
        let targetPositions = {};
        const mouse = { x: -9999, y: -9999, radius: w * 0.8 };

        // Generate target positions
        const tempCanvas = document.createElement('canvas');
        const tempCtx = tempCanvas.getContext('2d');
        tempCanvas.width = w;
        tempCanvas.height = h;

        const getPointsForText = (text, font) => {
            tempCtx.clearRect(0, 0, w, h);
            tempCtx.font = font;
            tempCtx.textAlign = 'center';
            tempCtx.textBaseline = 'middle';
            tempCtx.fillStyle = '#fff';
            tempCtx.fillText(text, w / 2, h / 2);
            
            const data = tempCtx.getImageData(0, 0, w, h).data;
            const points = [];
            for (let x = 0; x < w; x += 2) {
                for (let y = 0; y < h; y += 2) {
                    if (data[((x + y * w) * 4) + 3] > 150) {
                        points.push({ x, y });
                    }
                }
            }
            return points;
        };
        
        try {
            targetPositions.st = getPointsForText("ST", `500 ${w / 1.7}px "ivypresto-display", serif`);
        } catch(e) {
            console.error("Font loading error, retrying logo...", e);
            return setTimeout(() => this.createHeaderLogo(), 300);
        }

        const ensoTarget = [];
        const radius = w * 0.35;
        const centerX = w / 2;
        const centerY = h / 2;
        const numEnsoParticles = 200;
        for (let i = 0; i < numEnsoParticles; i++) {
            const angle = (i / (numEnsoParticles - 10)) * Math.PI * 1.85 - Math.PI * 0.9;
            ensoTarget.push({
                x: centerX + Math.cos(angle) * radius,
                y: centerY + Math.sin(angle) * radius,
            });
        }
        targetPositions.enso = ensoTarget;
        
        const numParticles = 200;
        const baseColor = { r: 16, g: 185, b: 129 };
        const darkColor = { r: 80, g: 80, b: 90 };
        for(let i=0; i<numParticles; i++) {
            particles.push({
                x: Math.random()*w, y: Math.random()*h,
                vx: 0, vy: 0,
                baseRadius: 0.5 + Math.random() * 1.2,
                radius: 1,
                color: {...baseColor},
                target: targetPositions.st[i % targetPositions.st.length] || {x:w/2, y:h/2}
            });
        }

        const spring = 0.03;
        const friction = 0.92;

        const loop = () => {
            ctx.clearRect(0, 0, w, h); // Clear for seamless background
            ctx.globalCompositeOperation = 'lighter'; // Additive blending for glow

            particles.forEach(p => {
                const dxMouse = p.x - mouse.x;
                const dyMouse = p.y - mouse.y;
                const distMouse = Math.sqrt(dxMouse*dxMouse + dyMouse*dyMouse);
                
                let forceX = 0;
                let forceY = 0;

                if (distMouse < mouse.radius) {
                    const angle = Math.atan2(dyMouse, dxMouse);
                    const force = (mouse.radius - distMouse) * 0.01;
                    forceX += Math.cos(angle) * force;
                    forceY += Math.sin(angle) * force;
                }

                p.vx += (p.target.x - p.x) * spring;
                p.vy += (p.target.y - p.y) * spring;
                p.vx += forceX;
                p.vy += forceY;
                p.vx *= friction;
                p.vy *= friction;
                p.x += p.vx;
                p.y += p.vy;
                
                const speed = Math.sqrt(p.vx*p.vx + p.vy*p.vy);
                p.radius = p.baseRadius + speed * 0.3;

                ctx.beginPath();
                ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(${p.color.r}, ${p.color.g}, ${p.color.b}, 0.9)`;
                ctx.fill();
            });
            
            ctx.globalCompositeOperation = 'source-over'; // Reset blend mode
            requestAnimationFrame(loop);
        };
        loop();
        
        this.logoAnimator = {
            setColor(isDark) {
                const targetColor = isDark ? darkColor : baseColor;
                particles.forEach(p => {
                    gsap.to(p.color, {
                        r: targetColor.r,
                        g: targetColor.g,
                        b: targetColor.b,
                        duration: 0.5,
                        ease: 'power2.out'
                    });
                });
            }
        };

        canvas.addEventListener('click', () => {
            mode = mode === 'st' ? 'enso' : 'st';
            const newTargets = targetPositions[mode];
            const maxTargets = newTargets.length;
            particles.forEach((p, i) => {
                 p.target = newTargets[i % maxTargets];
            });
        });
        
        canvas.addEventListener('mousemove', e => {
            const rect = canvas.getBoundingClientRect();
            mouse.x = (e.clientX - rect.left) * (w / rect.width);
            mouse.y = (e.clientY - rect.top) * (h / rect.height);
        });
        
        canvas.addEventListener('mouseleave', () => {
            mouse.x = -9999; mouse.y = -9999;
        });
    },
    
    createScene(id, options) {
        if(this.scenes[id]) {
            if (this.scenes[id].renderer) this.scenes[id].renderer.setAnimationLoop(this.scenes[id].animate);
            return this.scenes[id].animate;
        }
        const container = document.getElementById(id); if(!container) return;
        try {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, container.clientWidth/container.clientHeight, 0.1, 1000);
            camera.position.z = options.cameraZ || 5;

            const highPerf = navigator.hardwareConcurrency === undefined || navigator.hardwareConcurrency > 4;
            const renderer = new THREE.WebGLRenderer({
                antialias: highPerf,
                alpha:true,
                powerPreference: "high-performance"
            });
            renderer.setClearColor(0x000000, 0);
            renderer.setSize(container.clientWidth,container.clientHeight); 
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, highPerf ? 1.5 : 1));
            container.innerHTML = ''; 
            container.appendChild(renderer.domElement); 
            this.renderers.push(renderer);
            
            const sceneObjects = {};

            if (options.objects) { // Handle multiple objects
                options.objects.forEach(objDef => {
                    let obj;
                    if(objDef.type === 'Points') {
                        obj = new THREE.Points(objDef.geometry, objDef.material);
                    } else { // Default to Mesh
                        obj = new THREE.Mesh(objDef.geometry, objDef.material);
                    }
                    scene.add(obj);
                    sceneObjects[objDef.name] = obj;
                });
            } else if (options.geometry) { // Handle single object definitions
                 if (options.isPoints) {
                    const material = options.shader ? new THREE.ShaderMaterial(options.shader) : new THREE.PointsMaterial({...options.material});
                    const points = new THREE.Points(options.geometry, material);
                    scene.add(points);
                    sceneObjects.main = points;
                } else {
                    const material = options.shader ? new THREE.ShaderMaterial(options.shader) : new THREE.MeshBasicMaterial({...options.material});
                    const mesh = new THREE.Mesh(options.geometry, material);
                    scene.add(mesh);
                    sceneObjects.main = mesh;
                }
            }


            if (options.lighting) {
                scene.add(new THREE.AmbientLight(options.lighting.ambientColor, options.lighting.ambientIntensity));
                const light = new THREE.DirectionalLight(options.lighting.directionalColor, options.lighting.directionalIntensity);
                light.position.copy(options.lighting.directionalPosition);
                scene.add(light);
                sceneObjects.light = light;
            }

            const clock = new THREE.Clock();
            let lastFrameTime = 0;
            const animate = (time) => {
                if(!container.offsetParent) return;
                if(this.app.state.currentSlide !== options.slideIndex) {
                     if(this.scenes[id] && this.scenes[id].isActive) {
                        this.scenes[id].isActive = false;
                     }
                     return;
                }
                if(this.scenes[id] && !this.scenes[id].isActive) {
                    this.scenes[id].isActive = true;
                }
                renderer.setAnimationLoop(animate);
                
                if (time - lastFrameTime < 16.6) return; // Cap at ~60fps
                lastFrameTime = time;

                const t = clock.getElapsedTime();
                if(options.update) options.update({scene, camera, t, ...sceneObjects, renderer});
                renderer.render(scene, camera);
            };
            this.scenes[id] = {scene, camera, renderer, animate, objects: sceneObjects, isActive: true}; 
            renderer.setAnimationLoop(animate);
            return animate;
        } catch(e) {
            console.error(`Error creating scene "${id}":`, e);
            container.innerHTML = `<div class="text-red-500 text-center p-4">Animation failed to load.</div>`
        }
    },

    initCoverSphere() {
        const noiseFunc = `
            vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
            vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
            vec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }
            vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }
            float snoise(vec3 v) {
              const vec2  C = vec2(1.0/6.0, 1.0/3.0); const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
              vec3 i  = floor(v + dot(v, C.yyy)); vec3 x0 = v - i + dot(i, C.xxx);
              vec3 g = step(x0.yzx, x0.xyz); vec3 l = 1.0 - g; vec3 i1 = min(g, l.zxy); vec3 i2 = max(g, l.zxy);
              vec3 x1 = x0 - i1 + C.xxx; vec3 x2 = x0 - i2 + C.yyy; vec3 x3 = x0 - D.yyy;
              i = mod289(i);
              vec4 p = permute( permute( permute(i.z + vec4(0.0, i1.z, i2.z, 1.0)) + i.y + vec4(0.0, i1.y, i2.y, 1.0)) + i.x + vec4(0.0, i1.x, i2.x, 1.0));
              float n_ = 0.142857142857; vec3 ns = n_ * D.wyz - D.xzx;
              vec4 j = p - 49.0 * floor(p * ns.z * ns.z);
              vec4 x_ = floor(j * ns.z); vec4 y_ = floor(j - 7.0 * x_);
              vec4 x = x_ *ns.x + ns.yyyy; vec4 y = y_ *ns.x + ns.yyyy;
              vec4 h = 1.0 - abs(x) - abs(y); vec4 b0 = vec4(x.xy, y.xy); vec4 b1 = vec4(x.zw, y.zw);
              vec4 s0 = floor(b0)*2.0 + 1.0; vec4 s1 = floor(b1)*2.0 + 1.0; vec4 sh = -step(h, vec4(0.0));
              vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy; vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww;
              vec3 p0 = vec3(a0.xy,h.x); vec3 p1 = vec3(a0.zw,h.y); vec3 p2 = vec3(a1.xy,h.z); vec3 p3 = vec3(a1.zw,h.w);
              vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2,p2), dot(p3,p3)));
              p0 *= norm.x; p1 *= norm.y; p2 *= norm.z; p3 *= norm.w;
              vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
              m = m * m; return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3) ) );
            }
        `;
        
        const highPerf = navigator.hardwareConcurrency === undefined || navigator.hardwareConcurrency > 4;
        const blobDetail = highPerf ? 64 : 48;

        this.createScene('cover-sphere-container', {
            slideIndex: 0,
            isPoints: true,
            cameraZ: 8,
            geometry: new THREE.IcosahedronGeometry(1.8, blobDetail),
            shader: {
                uniforms: { uTime: { value: 0 }, uTransition: { value: 0.0 } },
                vertexShader: `
                    precision highp float;
                    ${noiseFunc}
                    uniform float uTime;
                    uniform float uTransition;
                    varying float vNoise;
                    void main() {
                        float rippleTime = uTime * 0.4;
                        float maxRadius = 15.0;
                        float particleRadius = mod(position.x * 2.5 + rippleTime * 3.0, maxRadius);
                        float angle = atan(position.z, position.y) + uTime * 0.1;
                        float life = pow(1.0 - (particleRadius / maxRadius), 2.0);
                        vec3 ripplePos = vec3(
                            particleRadius * cos(angle),
                            particleRadius * sin(angle),
                            sin(particleRadius * 2.5 - rippleTime * 10.0) * 0.4 * life
                        );
                        float noiseFrequency = 0.8;
                        float noiseStrength = 0.7;
                        float time = uTime * 0.1;
                        vec3 displacedPos = position + normal * snoise(position * noiseFrequency + time) * noiseStrength;
                        vNoise = snoise(position * 2.0 + time * 0.5);
                        vec3 finalPos = mix(ripplePos, displacedPos, uTransition);
                        vec4 mvPosition = modelViewMatrix * vec4(finalPos, 1.0);
                        gl_PointSize = (mix(0.8, 1.5, uTransition) * life) * (300.0 / -mvPosition.z);
                        gl_Position = projectionMatrix * mvPosition;
                    }
                `,
                fragmentShader: `
                    precision highp float;
                    varying float vNoise;
                    void main() {
                        float dist = distance(gl_PointCoord, vec2(0.5));
                        if (dist > 0.5) discard;
                        vec3 colorEmerald = vec3(0.063, 0.725, 0.506);
                        vec3 colorPurple = vec3(0.659, 0.333, 0.969);
                        vec3 finalColor = mix(colorEmerald, colorPurple, vNoise * 0.5 + 0.5);
                        float alpha = (1.0 - dist * 2.0);
                        gl_FragColor = vec4(finalColor, alpha);
                    }
                `
            },
            update:({ camera, t, main }) => {
                main.material.uniforms.uTime.value = t;
                gsap.to(main.material.uniforms.uTransition, { value: 1.0, duration: 8.0, ease: 'power2.inOut' });
                main.rotation.y = -t * 0.05;
                camera.lookAt(0,0,0);
            }
        });
    },

    initCreatorParticles(id) { 
        let particleColor = 0x10b981; // Default Pratt
        if (id.includes('diana')) particleColor = 0xa855f7;
        if (id.includes('riley')) particleColor = 0xf59e0b;

        return this.createScene(id,{
            slideIndex:8, cameraZ:2.5, 
            isPoints: true,
            geometry:new THREE.IcosahedronGeometry(1.2,5),
            material:{size:0.02, color: particleColor, wireframe:true, transparent:true, opacity:0.7},
            update:({main, t})=>{main.rotation.y=t*0.1; main.rotation.x=t*0.05;}
        }); 
    },

    initDripRipple() { 
        const isHighPerf = (navigator.hardwareConcurrency || 4) > 2;
        const particleCount = isHighPerf ? 10000 : 5000;
        const positions = new Float32Array(particleCount * 3);
        for(let i = 0; i < particleCount; i++) {
            const i3 = i * 3;
            const r = Math.sqrt(Math.random()) * 5;
            const a = Math.random() * Math.PI * 2;
            positions[i3] = Math.cos(a) * r;
            positions[i3+1] = Math.sin(a) * r;
            positions[i3+2] = (Math.random() - 0.5) * 0.1;
        }
        const geometry = new THREE.BufferGeometry();
        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

        this.createScene('drip-ripple-container', {
            slideIndex: 2, 
            cameraZ: 4,
            isPoints: true,
            geometry: geometry,
            shader: {
                uniforms: { 
                    uTime: { value: 0.0 },
                    uColor1: { value: new THREE.Color('#6f4e37')}, // Coffee Brown
                    uColor2: { value: new THREE.Color('#2a1a10')}, // Dark Espresso
                },
                vertexShader: `
                    precision highp float;
                    uniform float uTime;
                    varying float vIntensity;
                    void main() {
                        vec3 pos = position;
                        float dist = length(pos.xy);
                        float wave = sin(dist * 2.5 - uTime * 2.5) * 0.3;
                        pos.z += wave * smoothstep(5.0, 0.0, dist);
                        vIntensity = smoothstep(5.0, 0.5, dist);
                        vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);
                        gl_PointSize = (15.0 / -mvPosition.z) * vIntensity;
                        gl_Position = projectionMatrix * mvPosition;
                    }
                `,
                fragmentShader: `
                    precision highp float;
                    uniform vec3 uColor1;
                    uniform vec3 uColor2;
                    varying float vIntensity;
                    void main() {
                        float dist = distance(gl_PointCoord, vec2(0.5));
                        if(dist > 0.5) discard;
                        vec3 color = mix(uColor2, uColor1, vIntensity * 1.5);
                        gl_FragColor = vec4(color, (1.0 - dist * 2.0) * vIntensity * 1.5);
                    }
                `,
                blending: THREE.AdditiveBlending,
                transparent: true, 
                depthWrite: false,
            },
            update: ({main, t, camera}) => {
                main.material.uniforms.uTime.value = t;
                main.rotation.z = t * 0.05;
                camera.position.z = 4.0 - Math.sin(t * 0.3) * 0.5;
            }
        });
    },
    
    initVenuePointCloud() {
        const points = [];
        const colors = [];
        const sextantColor = new THREE.Color(0xa855f7);
        const streetColor = new THREE.Color(0x10b981);
        const highPerf = navigator.hardwareConcurrency === undefined || navigator.hardwareConcurrency > 4;

        for(let i = -20; i <= 20; i += 1.5) { 
            for(let j = -20; j <= 20; j += 1.5) { 
                points.push(i, -5, j); 
                streetColor.toArray(colors, colors.length); 
            } 
        }

        for(let i = -25; i <= 25; i += 0.5) { 
            points.push(i, -4.9, 0);
            streetColor.toArray(colors, colors.length);
        }
         for(let i = -25; i <= 25; i += 0.5) { 
            points.push(0, -4.9, i);
            streetColor.toArray(colors, colors.length);
        }

        const buildingParticleCount = highPerf ? 6000 : 3000;
        const bx=-5, by=-5, bz=-5, bw=10, bh=8, bd=10;
        for (let i=0; i<buildingParticleCount; i++) { 
            points.push(bx+Math.random()*bw, by+Math.random()*bh, bz+Math.random()*bd); 
            sextantColor.toArray(colors, colors.length); 
        }
        
        this.createScene('venue-point-cloud', { 
            slideIndex:3, cameraZ:10, 
            isPoints: true,
            geometry: new THREE.BufferGeometry(),
            material:{size:0.1, vertexColors: true, transparent:true,opacity:0.8, blending: THREE.AdditiveBlending},
            update:({main, camera,t})=>{
                if (!main.geometry.getAttribute('position')) {
                    main.geometry.setAttribute('position', new THREE.Float32BufferAttribute(new Float32Array(points), 3));
                    main.geometry.setAttribute('color', new THREE.Float32BufferAttribute(new Float32Array(colors), 3));
                }
                camera.position.x = Math.sin(t * 0.05) * 20;
                camera.position.z = Math.cos(t * 0.05) * 20;
                camera.position.y = 3 + Math.sin(t * 0.1) * 3;
                camera.lookAt(0,0,0);
            }
        });
    },
    
    // REBUILT finale animation with hover
    initFinaleRipple() {
        const isHighPerf = (navigator.hardwareConcurrency || 4) > 2;
        const segments = isHighPerf ? 200 : 128;
        const geometry = new THREE.PlaneGeometry(30, 30, segments, segments);
        const mouse = new THREE.Vector2(-99, -99);
        const targetMouse = new THREE.Vector2(-99, -99);

        const updateVertices = (time, positions, mousePos) => {
            const t = time * 0.5;
            for (let i = 0; i < positions.length; i += 3) {
                const x = positions[i];
                const y = positions[i+1];
                const dist = Math.sqrt(x*x + y*y);
                const idleWave = (Math.sin(dist * 1.2 - t * 1.5) + Math.sin((x + y) * 0.8 + t)) * 0.4 * Math.pow(1.0 - (dist/20.0), 2.0);
                
                const mouseDist = Math.sqrt(Math.pow(x - mousePos.x, 2) + Math.pow(y - mousePos.y, 2));
                const mouseWave = Math.pow(Math.max(0.0, 1.0 - mouseDist / 4.0), 2.0) * -3.0;

                positions[i+2] = idleWave + mouseWave;
            }
        };
        
        this.createScene('finale-animation', {
            slideIndex: 10,
            cameraZ: 10,
            objects: [
                {
                    name: 'surface',
                    type: 'Mesh',
                    geometry: geometry.clone(),
                    material: new THREE.MeshBasicMaterial({
                        color: 0x10b981,
                        wireframe: true,
                        transparent: true,
                        opacity: 0.2
                    })
                },
                {
                    name: 'particles',
                    type: 'Points',
                    geometry: geometry, // Use the same geometry
                    material: new THREE.PointsMaterial({
                        color: 0xa855f7,
                        size: 0.05,
                        transparent: true,
                        opacity: 0.7,
                        blending: THREE.AdditiveBlending,
                        depthWrite: false,
                    })
                }
            ],
            update: ({ camera, t, surface, particles, renderer }) => {
                mouse.lerp(targetMouse, 0.05);

                const positions = particles.geometry.attributes.position.array;
                updateVertices(t, positions, mouse);
                particles.geometry.attributes.position.needsUpdate = true;
                surface.geometry.attributes.position.needsUpdate = true;

                camera.position.x = Math.sin(t * 0.1) * 5;
                camera.position.z = Math.cos(t * 0.1) * 10;
                camera.position.y = 6;
                camera.lookAt(0, 0, 0);

                if (!renderer.domElement.hasAttribute('data-mouse-listener')) {
                    renderer.domElement.setAttribute('data-mouse-listener', 'true');
                    const raycaster = new THREE.Raycaster();
                    const plane = new THREE.Plane(new THREE.Vector3(0, 0, 1), 0);
                    renderer.domElement.addEventListener('mousemove', (e) => {
                        const rect = renderer.domElement.getBoundingClientRect();
                        const pointer = new THREE.Vector2(
                            ((e.clientX - rect.left) / rect.width) * 2 - 1,
                           -((e.clientY - rect.top) / rect.height) * 2 + 1
                        );
                        raycaster.setFromCamera(pointer, camera);
                        const intersectPoint = new THREE.Vector3();
                        raycaster.ray.intersectPlane(plane, intersectPoint);
                        targetMouse.set(intersectPoint.x, intersectPoint.y);
                    }, false);
                    renderer.domElement.addEventListener('mouseleave', () => {
                        targetMouse.set(-99,-99);
                    });
                }
            }
        });
    },

    initChart(id,config){if(this.scenes[id])this.scenes[id].destroy();const c=document.getElementById(id)?.getContext('2d');if(!c)return;this.scenes[id]=new Chart(c,config);},
    initSalesChart(){this.initChart('sales-breakdown-chart',{type:'bar',data:{labels:['Ticket Sales', 'Drink Sales'],datasets:[{label: 'Revenue', data: [1235, 1050], backgroundColor:['#10b981', '#a855f7']}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{ticks:{color:'white',callback:v=>`$${v}`},grid:{color:'rgba(255,255,255,0.1)'}},x:{ticks:{color:'white'},grid:{display:false}}}}});},
    initGrowthChart(){this.initChart('growth-chart',{type:'radar',data:{labels:['Revenue Lift','Brand Awareness','Foot Traffic','Community Growth','Media Buzz'],datasets:[{label:'Projected Growth',data:[85,75,60,95,70],backgroundColor:'rgba(16,185,129,0.3)',borderColor:'#10b981',borderWidth:2,pointBackgroundColor:'#10b981',pointBorderColor:'#fff',pointRadius:4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{backgroundColor:'rgba(10, 14, 26, 0.8)',bodyFont:{size:12},bodySpacing: 4, padding:12, callbacks:{title:(c)=>c[0].label,label:(c)=>{const v=c.parsed.r;let e='';switch(c.label){case'Revenue Lift':e='Projected increase in nightly revenue from extended hours and premium offerings.';break;case'Brand Awareness':e='Increased social media buzz and word-of-mouth recognition in the target demographic.';break;case'Foot Traffic':e='Attracting new and returning customers during previously off-peak evening hours.';break;case'Community Growth':e='Building a loyal community around unique, shared experiences, fostering retention.';break;case'Media Buzz':e="Generating organic press and influencer mentions due to the event's novelty.";break;}return[`Value: ${v}%`,`Potential: ${e}`];}}}},scales:{r:{angleLines:{color:'rgba(255,255,255,0.1)'},grid:{color:'rgba(255,255,255,0.15)'},pointLabels:{color:'white',font:{size:12,family:"'Inter',sans-serif"}},ticks:{display:false,beginAtZero:true,max:100}}}}});},
    
    handleResize(){this.renderers.forEach(r=>{const c=r.domElement.parentElement;if(c&&c.clientWidth>0){const m=Object.values(this.scenes).find(s=>s&&s.renderer===r)?.camera;if(m){m.aspect=c.clientWidth/c.clientHeight;m.updateProjectionMatrix();}r.setSize(c.clientWidth,c.clientHeight);}});Object.values(this.scenes).forEach(s=>{if(s instanceof Chart&&s.resize)s.resize();});},
    
    getAnimFunction(slideIndex) {
        const animMap={0:this.initCoverSphere,2:this.initDripRipple,3:this.initVenuePointCloud,8:() => { Animations.initCreatorParticles('pratt-particles')(); Animations.initCreatorParticles('diana-particles')(); Animations.initCreatorParticles('riley-particles')(); },10:this.initFinaleRipple};
        return animMap[slideIndex]?.bind(this);
    }
};

const Content = {
    init(app) { 
        this.app=app; 
        this.initialTransforms=new Map(); 
        document.querySelectorAll('.venue-item').forEach(i=>this.initialTransforms.set(i,{transform:i.style.transform,top:i.style.top,left:i.style.left,width:i.style.width,height:i.style.height})); 
    },
    onSlideChange(slideIndex){
        Object.values(Animations.scenes).forEach(s=>s&&s.renderer&&!s.isActive && s.renderer.setAnimationLoop(null));
        const f=Animations.getAnimFunction(slideIndex);
        if(f){try{const r=f();if(r)r();}catch(e){console.error(`Failed to init animation for slide ${slideIndex}`, e)}}
        switch(slideIndex){
            case 1:Animations.createScene('bell-cloud',{slideIndex:1,cameraZ:1.5,geometry:new THREE.CylinderGeometry(0,0.6,1.2,16,4),material:{size:0.05,color:0x10b981},update:({main,t})=>{main.rotation.y=t*0.1;}});Animations.createScene('heart-cloud',{slideIndex:1,cameraZ:2.5,geometry:new THREE.ShapeGeometry(new THREE.Shape().moveTo(0.25,0.25).bezierCurveTo(0.25,0.25,0.2,0,0,0).bezierCurveTo(-0.3,0,-0.3,0.35,-0.3,0.35).bezierCurveTo(-0.3,0.55,-0.1,0.77,0.25,0.95).bezierCurveTo(0.6,0.77,0.8,0.55,0.8,0.35).bezierCurveTo(0.8,0.35,0.8,0,0.5,0).bezierCurveTo(0.35,0,0.25,0.25,0.25,0.25), 30),material:{size:0.04,color:0xa855f7},update:({main,t})=>{main.rotation.y=t*0.1;}});Animations.createScene('star-cloud',{slideIndex:1,cameraZ:1.5,geometry:new THREE.ShapeGeometry(new THREE.Shape().moveTo(0,0.5).lineTo(0.1,0.1).lineTo(0.5,0.1).lineTo(0.2,-0.1).lineTo(0.3,-0.5).lineTo(0,-0.2).lineTo(-0.3,-0.5).lineTo(-0.2,-0.1).lineTo(-0.5,0.1).lineTo(-0.1,0.1).lineTo(0,0.5), 10),material:{size:0.04,color:0x06b6d4},update:({main,t})=>{main.rotation.y=t*0.1;}});break;
            case 2:this.setupMenuSystem(); this.setupEventTimeline(); break;
            case 3:this.setupInteractiveVenue();break;
            case 4:this.setupMarketingExecTabs();break;
            case 6:this.setupFinancialCalculator();break;
            case 7:Animations.initGrowthChart();break;
            case 8: Animations.initCreatorParticles('pratt-particles')(); Animations.initCreatorParticles('diana-particles')(); Animations.initCreatorParticles('riley-particles')(); break;
            case 9:this.setupTaskPlanner();break;
        }
    },
    updateLogoContrast() {
        if (!App.state.activeSlideElement || !Animations.logoAnimator) return;
        const logoRect = App.DOM.headerLogo.getBoundingClientRect();
        const titleEl = App.state.activeSlideElement.querySelector('.display-2');
        if (!titleEl) {
            Animations.logoAnimator.setColor(false); // Default to bright if no title
            return;
        }
        const titleRect = titleEl.getBoundingClientRect();
        
        const isOverlapping = !(logoRect.right < titleRect.left || 
                                logoRect.left > titleRect.right || 
                                logoRect.bottom < titleRect.top || 
                                logoRect.top > titleRect.bottom);
                                
        Animations.logoAnimator.setColor(isOverlapping);
    },
    setupMenuSystem(){
        const grid = document.getElementById('menu-grid');
        if (!grid || grid.children.length > 0) return;
        grid.innerHTML = menuData.map(item => `
            <div class="menu-item-card" onclick="Content.showMenuModal('${item.id}')" style="border-left: 3px solid ${item.color};">
                <h4 class="item-card-title" style="color:${item.color};">${item.name}</h4>
                <p class="item-card-desc">${item.desc}</p>
                <p class="item-card-price" style="color:${item.color};">${item.price}</p>
            </div>
        `).join('');
    },
    showMenuModal(itemId) {
        const item = menuData.find(i => i.id === itemId);
        if(!item) return;

        const container = this.app.DOM.menuModalContainer;
        const ingredientsHTML = item.ingredients.map(ing => `<li><a href="${ing.link}" target="_blank" class="text-emerald-400 hover:underline">${ing.name}</a></li>`).join('');

        container.innerHTML = `
            <div class="menu-modal-content card" onclick="event.stopPropagation()">
                <button class="menu-modal-close" onclick="Content.hideModal('menuModalContainer')">&times;</button>
                <h3 class="heading-1" style="color:${item.color};">${item.name}</h3>
                <p class="body-large mt-2">${item.desc}</p>
                 <div class="menu-modal-details">
                    <span>Prep Time: ${item.prepTime}</span>
                    <span>Profit Margin: ~${item.profitMargin}</span>
                </div>
                <div class="mt-6 grid md:grid-cols-2 gap-8">
                    <div>
                        <h4 class="font-semibold text-white mb-2">Recipe</h4>
                        <p class="body-regular">${item.recipe}</p>
                    </div>
                    <div>
                        <h4 class="font-semibold text-white mb-2">Key Ingredients</h4>
                        <ul class="body-regular list-disc list-inside">${ingredientsHTML}</ul>
                    </div>
                </div>
            </div>
        `;
        container.classList.add('visible');
    },
    setupEventTimeline(){const w=document.getElementById('event-timeline');if(!w||w.children.length>0)return;w.innerHTML=timelineData.map(e=>`<div class="timeline-event" onclick="toggleExpand(this)"><div class="timeline-event-main" style="border-top: 2px solid ${e.color};"><div class="time" style="color:${e.color};">${e.time}</div><h4 style="color:${e.color};">${e.title}</h4><p>${e.desc}</p></div><div class="timeline-event-details body-regular"><p class="font-semibold text-gray-300 mb-2">Sensory Focus:</p><p class="text-gray-400 mb-4">${e.sensory_focus}</p><p class="font-semibold text-gray-300 mb-2">Content Capture:</p><p class="text-gray-400">${e.content_capture}</p></div></div>`).join('');},
    setupInteractiveVenue(){const v=document.getElementById('interactive-venue');if(!v||v.dataset.i)return;v.dataset.i='1';let a=null,o={x:0,y:0},s={x:0,y:0},z={w:0,h:0},g=0;const t=e=>{const i=e.target.closest('.venue-item');if(!i)return;a=i;document.querySelectorAll('.venue-item').forEach(l=>l.classList.remove('selected'));a.classList.add('selected');a.style.zIndex=100;const n=e.touches?e.touches[0]:e,r=a.getBoundingClientRect();o={x:n.clientX-r.left,y:n.clientY-r.top};z={w:a.offsetWidth,h:a.offsetHeight};s={x:n.clientX,y:n.clientY};const c=new DOMMatrix(window.getComputedStyle(a).transform),d=Math.atan2(c.b,c.a);g=d-Math.atan2(n.clientY-(r.top+r.height/2),n.clientX-(r.left+r.width/2));window.addEventListener('mousemove',m);window.addEventListener('mouseup',p);window.addEventListener('touchmove',m,{passive:!1});window.addEventListener('touchend',p);e.preventDefault();};const m=e=>{if(!a)return;e.preventDefault();const i=e.touches?e.touches[0]:e,n=v.getBoundingClientRect(),r=this.currentVenueMode;if(r==='move'){let c=i.clientX-n.left-o.x,d=i.clientY-n.top-o.y;c=Math.max(0,Math.min(c,n.width-a.offsetWidth));d=Math.max(0,Math.min(d,n.height-a.offsetHeight));a.style.left=`${c}px`;a.style.top=`${d}px`;}else if(r==='resize'){const c=i.clientX-s.x,d=i.clientY-s.y;a.style.width=`${Math.max(50,z.w+c)}px`;a.style.height=`${Math.max(50,z.h+d)}px`;}else if(r==='rotate'){const c=a.getBoundingClientRect(),d=Math.atan2(i.clientY-(c.top+c.height/2),i.clientX-(c.left+c.width/2));a.style.transform=`rotate(${g+d}rad)`;}};const p=()=>{if(a){a.classList.remove('selected');a.style.zIndex='';}a=null;window.removeEventListener('mousemove',m);window.removeEventListener('mouseup',p);window.removeEventListener('touchmove',m);window.removeEventListener('touchend',p);};v.addEventListener('mousedown',t);v.addEventListener('touchstart',t,{passive:!1});},
    setVenueMode(mode){this.currentVenueMode=mode;document.querySelectorAll('.venue-mode-btn').forEach(b=>b.classList.remove('active'));document.querySelector(`.venue-mode-btn[onclick="setVenueMode('${mode}')"]`).classList.add('active');},
    setupMarketingExecTabs() {
        const marketingItems = document.querySelectorAll('.marketing-item');
        marketingItems.forEach(item => {
            const tabs = item.querySelectorAll('.execution-tab');
            const contents = item.querySelectorAll('.execution-content');
            tabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const tabId = e.target.dataset.tab;

                    tabs.forEach(t => t.classList.remove('active'));
                    e.target.classList.add('active');

                    contents.forEach(c => c.classList.remove('active'));
                    item.querySelector(`.execution-content[data-tab-content="${tabId}"]`).classList.add('active');
                });
            });
        });
    },
    resetVenueLayout(){document.querySelectorAll('.venue-item').forEach(i=>{const n=this.initialTransforms.get(i);if(n){i.style.transform=n.transform;i.style.top=n.top;i.style.left=n.left;i.style.width=n.width;i.style.height=n.height;}});},
    setupFinancialCalculator(){this.calculateRevenue();},
    calculateRevenue(){
        const f = (id) => parseFloat(document.getElementById(id).value) || 0;
        const tier1Qty = f('tier1-qty'), tier2Qty = f('tier2-qty'), tier3Qty = f('tier3-qty');
        const addonPerPerson = f('addon-drinks-per-person');
        
        const tier1Price = 20, tier2Price = 28, tier3Price = 35;
        const avgDrinkPrice = 14, cogsRate = 0.3;
        
        // Costs
        const permitCost = 200;
        const insuranceCost = 150;
        const djCost = 400;
        const productionCost = 250; 
        const marketingPrintCost = 150;
        const marketingDigitalCost = 100;
        const baristaCosts = 225;

        const totalAttendees = tier1Qty + tier2Qty + tier3Qty;
        const totalTicketRevenue = (tier1Qty * tier1Price) + (tier2Qty * tier2Price) + (tier3Qty * tier3Price);
        const totalDrinkRevenue = totalAttendees * addonPerPerson * avgDrinkPrice;
        const totalGrossRevenue = totalTicketRevenue + totalDrinkRevenue;
        
        const drinkCOGS = totalDrinkRevenue * cogsRate;

        // Sextant P&L
        const sextantTicketShare = totalTicketRevenue * 0.30;
        const sextantDrinkShare = (totalDrinkRevenue - drinkCOGS) * 0.50;
        const sextantGrossProfit = sextantTicketShare + sextantDrinkShare;
        const sextantNetProfit = sextantGrossProfit - permitCost - baristaCosts - (drinkCOGS / 2) - marketingPrintCost;

        // Surface Tension P&L
        const stTicketShare = totalTicketRevenue * 0.70;
        const stDrinkShare = (totalDrinkRevenue - drinkCOGS) * 0.50;
        const stCosts = djCost + productionCost + insuranceCost + marketingDigitalCost + (drinkCOGS / 2);
        const stProfit = stTicketShare + stDrinkShare - stCosts;

        // Update DOM
        document.getElementById('total-revenue').textContent = `$${totalGrossRevenue.toLocaleString('en-US',{maximumFractionDigits:0})}`;
        document.getElementById('sextant-ticket-share').textContent = `+$${sextantTicketShare.toLocaleString('en-US',{maximumFractionDigits:0})}`;
        document.getElementById('sextant-drink-share').textContent = `+$${sextantDrinkShare.toLocaleString('en-US',{maximumFractionDigits:0})}`;
        document.getElementById('sextant-gross-profit').textContent = `$${sextantGrossProfit.toLocaleString('en-US',{maximumFractionDigits:0})}`;

        // Update Chart
        if(!Animations.scenes['sales-breakdown-chart']) Animations.initSalesChart();
        const salesChart = Animations.scenes['sales-breakdown-chart'];
        salesChart.data.datasets[0].data = [totalTicketRevenue, totalDrinkRevenue];
        salesChart.update();
        
        // Cache data for modal
        revenueBreakdownCache = {
            sextantGrossProfit, permitCost, baristaCosts, marketingPrintCost, sextantCOGS: drinkCOGS/2, sextantNetProfit,
            stGrossProfit: stTicketShare + stDrinkShare, djCost, productionCost, insuranceCost, marketingDigitalCost, stCOGS: drinkCOGS/2, stProfit
        };
    },
    showRevenueBreakdown() {
        const data = revenueBreakdownCache;
        const F = (val) => val.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 });
        const container = App.DOM.revenueModalContainer;
        container.innerHTML = `
            <div class="revenue-modal-content card" onclick="event.stopPropagation()">
                <button class="menu-modal-close" onclick="Content.hideModal('revenueModalContainer')">&times;</button>
                <h3 class="heading-1">Full P&L Breakdown</h3>
                <div class="grid grid-cols-2 gap-8 mt-6 body-regular">
                    <div>
                        <h4 class="font-semibold text-purple-400 mb-2 border-b border-purple-800 pb-1">Sextant P&L</h4>
                        <div class="flex justify-between"><span>Gross Profit:</span> <span class="text-green-400">${F(data.sextantGrossProfit)}</span></div>
                        <div class="flex justify-between text-red-400"><span>- 50% COGS:</span> <span>(${F(data.sextantCOGS)})</span></div>
                        <div class="flex justify-between text-red-400"><span>- Permit:</span> <span>(${F(data.permitCost)})</span></div>
                        <div class="flex justify-between text-red-400"><span>- Baristas:</span> <span>(${F(data.baristaCosts)})</span></div>
                        <div class="flex justify-between text-red-400"><span>- Print Marketing:</span> <span>(${F(data.marketingPrintCost)})</span></div>
                        <div class="flex justify-between mt-2 pt-2 border-t border-purple-500 font-bold text-lg"><span class="text-purple-300">Net Profit:</span> <span class="text-purple-300">${F(data.sextantNetProfit)}</span></div>
                    </div>
                     <div>
                        <h4 class="font-semibold text-emerald-400 mb-2 border-b border-emerald-800 pb-1">Surface Tension P&L</h4>
                        <div class="flex justify-between"><span>Gross Profit:</span> <span class="text-green-400">${F(data.stGrossProfit)}</span></div>
                        <div class="flex justify-between text-red-400"><span>- 50% COGS:</span> <span>(${F(data.stCOGS)})</span></div>
                        <div class="flex justify-between text-red-400"><span>- DJ:</span> <span>(${F(data.djCost)})</span></div>
                        <div class="flex justify-between text-red-400"><span>- Production:</span> <span>(${F(data.productionCost)})</span></div>
                        <div class="flex justify-between text-red-400"><span>- Insurance:</span> <span>(${F(data.insuranceCost)})</span></div>
                        <div class="flex justify-between text-red-400"><span>- Digital Marketing:</span> <span>(${F(data.marketingDigitalCost)})</span></div>
                        <div class="flex justify-between mt-2 pt-2 border-t border-emerald-500 font-bold text-lg"><span class="text-emerald-300">Net Profit:</span> <span class="text-emerald-300">${F(data.stProfit)}</span></div>
                    </div>
                </div>
            </div>
        `;
        container.classList.add('visible');
    },
    hideModal(id) {
        App.DOM[id].classList.remove('visible');
    },
    setupTaskPlanner(){
        const savedTasks = localStorage.getItem('surfaceTensionTasks');
        taskData = savedTasks ? JSON.parse(savedTasks) : [
            { id: 1, week: 1, title: "Partnership & Financials Finalized", assignee: "pratt", status: 'completed', dates: {start: "20250623", end: "20250624"}, desc: "<b>Goal:</b> Execute final partnership agreement. <br><b>Action:</b> Sign agreement with Sextant outlining roles, and the updated financial structure.", notes: "Agreement signed. Financial model confirmed." },
            { id: 2, week: 1, title: "Initiate Permit & Insurance Path", assignee: "riley", status: 'completed', dates: {start: "20250624", end: "20250627"}, desc: "<b>Goal:</b> Determine the exact compliance path of least resistance and cost. <br><b>Action:</b> Contact SFEC, confirm One-Time Indoor permit. Secure quotes for one-day event liability insurance. <br><b>Reference:</b> <a href='https://sf.gov/get-entertainment-permit-your-indoor-event' target='_blank' class='text-teal-400 hover:underline'>SF.gov Indoor Permit</a>", notes: "Confirmed path with city. Insurance quotes received." },
            { id: 3, week: 1, title: "Launch Phase 1: Digital Speakeasy", assignee: "pratt", status: 'completed', dates: {start: "20250625", end: "20250628"}, desc: "<b>Goal:</b> Create the initial layer of mystique. <br><b>Action:</b> Launch password-protected microsite. Begin leaking password 'STILLNESS' into niche online communities.", notes: "Microsite is live. Initial seeding in progress." },
            { id: 4, week: 1, title: "Finalize Menu & Sourcing", assignee: "sextant", status: 'approval', dates: {start: "20250624", end: "20250628"}, desc: "<b>Goal:</b> Lock in the complete beverage offering based on the curated menu. <br><b>Action:</b> Finalize all supplier agreements for in-kind sponsorships and purchased goods. Set pars for all ingredients.", notes: "Awaiting final confirmation on N/A spirit sponsor." },
            { id: 5, week: 2, title: "Submit Permit & Bind Insurance", assignee: "riley", status: 'in_progress', dates: {start: "20250630", end: "20250702"}, desc: "<b>Goal:</b> Formally file for all necessary compliance documents. <br><b>Action:</b> Submit the One-Time Indoor Permit application. Bind the selected event insurance policy.", notes: "Application submitted. Awaiting confirmation of receipt." },
            { id: 6, week: 2, title: "Artist Confirmation & Briefing", assignee: "pratt", status: 'completed', dates: {start: "20250701", end: "20250703"}, desc: "<b>Goal:</b> Secure musical talent. <br><b>Action:</b> Finalize agreement and honorarium with the selected DJ. Conducted creative briefing call.", notes: "DJ confirmed and briefed on sonic direction." },
            { id: 7, week: 2, title: "Design Physical & Digital Assets", assignee: "diana", status: 'in_progress', dates: {start: "20250702", end: "20250705"}, desc: "<b>Goal:</b> Create all marketing visuals. <br><b>Action:</b> Design the A5 poster, social media motion graphic trailer, and any in-venue digital assets.", notes: "Poster design in final review. Motion graphic storyboard approved." },
            { id: 8, week: 2, title: "Secure Production Gear & Sponsors", assignee: "riley", status: 'initiated', dates: {start: "20250630", end: "20250705"}, desc: "<b>Goal:</b> Secure all technical equipment via sponsorship or rental. <br><b>Action:</b> Finalize in-kind agreements with Sonic and Elixir partners. Book any remaining rental gear.", notes: "d&b partnership confirmed. Ghia pending." },
            { id: 9, week: 3, title: "Execute Phase 3: The Artifacts", assignee: "diana", status: 'not_started', dates: {start: "20250707", end: "20250711"}, desc: "<b>Goal:</b> Deepen the brand mythos and launch ticket sales. <br><b>Action:</b> Print and distribute the 50 physical posters. Release cinematic trailer on social media. Open ticket sales.", notes: "Dependent on completing poster design and ticketing setup." },
            { id: 10, week: 3, title: "Permit Follow-up", assignee: "riley", status: 'not_started', dates: {start: "20250708", end: "20250710"}, desc: "<b>Goal:</b> Ensure permit is on track for approval. <br><b>Action:</b> Follow up with the commission contact for a status update and address any questions.", notes: "Scheduled for next week." },
            { id: 11, week: 3, title: "In-Store Marketing Rollout", assignee: "collaborative", status: 'not_started', dates: {start: "20250709", end: "20250713"}, desc: "<b>Goal:</b> Activate Sextant's physical space as a marketing channel. <br><b>Action:</b> Diana to deliver printed posters/flyers. Sextant to display materials and brief staff on the event.", notes: "Collaboration pending asset finalization." },
            { id: 12, week: 4, title: "Execute Phase 2: Guerrilla Marketing", assignee: "collaborative", status: 'not_started', dates: {start: "20250717", end: "20250718"}, desc: "<b>Goal:</b> Create real-world mystery and intrigue. <br><b>Action:</b> Pratt & Riley to execute late-night projections and sound beaming at pre-determined, high-visibility locations.", notes: "Locations scouted, awaiting execution window." },
            { id: 13, week: 4, title: "Operational & Staffing Plan", assignee: "collaborative", status: 'initiated', dates: {start: "20250714", end: "20250718"}, desc: "<b>Goal:</b> Finalize the day-of-event run-of-show. <br><b>Action:</b> Create detailed floor plan, setup/breakdown schedule, and staffing assignments. Conduct joint briefing. <br><b>Collaboration:</b> Pratt, Diana, Riley, Sextant", notes: "Drafting of run-of-show has begun." },
            { id: 14, week: 5, title: "Launch Phase 5: Final Push", assignee: "diana", status: 'not_started', dates: {start: "20250721", end: "20250724"}, desc: "<b>Goal:</b> Drive final ticket sales to sell-out. <br><b>Action:</b> Launch hyper-targeted digital ad campaign. Final email blast to mailing list with 'Low Ticket' warning.", notes: "Ad creative to be finalized by Pratt." },
            { id: 15, week: 5, title: "Final Permit Confirmation", assignee: "riley", status: 'not_started', dates: {start: "20250721", end: "20250722"}, desc: "<b>Goal:</b> Have permit physically in hand. <br><b>Action:</b> Final confirmation with the commission. Pick up the physical permit if necessary.", notes: "" },
            { id: 16, week: 5, title: "Day-Of Production & Staging (July 25)", assignee: "collaborative", status: 'not_started', dates: {start: "20250725", end: "20250725"}, desc: "<b>Goal:</b> Flawless technical execution. <br><b>Action:</b> Riley to manage equipment delivery and setup. Pratt to oversee sound check, lighting calibration, and full technical rehearsal. Sextant to prep bar.", notes: "Run-of-show required." }
        ];

        this.renderTasks('all');
        document.querySelectorAll('.task-filter').forEach(b=>{b.onclick=()=>{document.querySelectorAll('.task-filter').forEach(e=>e.classList.remove('active'));b.classList.add('active');this.renderTasks(b.dataset.filter);};});
    },
    saveTasks() {
        localStorage.setItem('surfaceTensionTasks', JSON.stringify(taskData));
    },
    renderTasks(filter){
        const container = document.getElementById('task-list');
        if (!container) return;
        let filteredTasks = taskData.filter(task => {
            if (filter === 'all') return true;
            if (filter === 'collaborative') return task.assignee === 'collaborative';
            return task.assignee === filter || (task.assignee === 'collaborative' && (task.desc.toLowerCase().includes(filter)));
        });

        const statusMap = [
            { id: 'not_started', text: 'Not Started', color: '#6b7280' },
            { id: 'initiated', text: 'Initiated', color: '#3b82f6' },
            { id: 'in_progress', text: 'In Progress', color: '#f59e0b' },
            { id: 'approval', text: 'Approval', color: '#a855f7' },
            { id: 'completed', text: 'Completed', color: '#10b981' }
        ];

        container.innerHTML = filteredTasks.map((task, index) => {
            const assigneeClass = task.assignee.replace('-', ' ');
            const assigneeName = task.assignee === 'collaborative' ? 'Collaborative' : assigneeClass;
            const currentStatusIndex = statusMap.findIndex(s => s.id === task.status);

            let progressBarHTML = statusMap.map((status, i) => {
                const isActive = i <= currentStatusIndex;
                return `<div class="progress-segment" style="background-color: ${isActive ? status.color : 'transparent'}" onclick="event.stopPropagation(); Content.updateTaskStatus(${task.id}, '${status.id}')"></div>`;
            }).join('');

            return `
                <div class="task-card" data-id="${task.id}">
                    <div class="task-main-content" onclick="toggleExpand(this.parentElement)">
                        <div class="task-header">
                            <div class="task-title-group">
                                <div class="task-week">Week ${task.week}</div>
                                <h4 class="text-white font-semibold">${task.title}</h4>
                            </div>
                            <span class="task-assignee ${task.assignee}">${assigneeName}</span>
                        </div>
                        <div class="task-progress mt-2" style="color: ${statusMap[currentStatusIndex].color}">${(currentStatusIndex / (statusMap.length - 1) * 100).toFixed(0)}% ${statusMap[currentStatusIndex].text}</div>
                        <div class="progress-bar-container">${progressBarHTML}</div>
                    </div>
                    <div class="task-details">
                        <p class="body-regular text-gray-300">${task.desc}</p>
                        <textarea class="task-notes-input" placeholder="Add notes..." oninput="Content.updateTaskNotes(${task.id}, this.value)">${task.notes || ''}</textarea>
                        <a href="${this.getCalendarLink(task)}" target="_blank" class="task-calendar-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 1a.5.5 0 0 1 .5.5v1h-1V1.5A.5.5 0 0 1 8 1zM3.5 3a.5.5 0 0 0-.5.5V4h9V3.5a.5.5 0 0 0-.5-.5h-8zM13 5H3v6.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5V5z"/><path d="M1 4v10.5A1.5 1.5 0 0 0 2.5 16h11a1.5 1.5 0 0 0 1.5-1.5V4H1zm13-1.5a.5.5 0 0 1 .5.5V3H1.5a.5.5 0 0 1-.5-.5V2.5A1.5 1.5 0 0 1 2.5 1h11A1.5 1.5 0 0 1 14 2.5zM8.5 7a.5.5 0 0 0-1 0v1.5H6a.5.5 0 0 0 0 1h1.5V11a.5.5 0 0 0 1 0V9.5H10a.5.5 0 0 0 0-1H8.5V7z"/></svg>
                            Add to Calendar
                        </a>
                    </div>
                </div>`;
        }).join('');
    },
    updateTaskStatus(taskId, newStatus) {
        const task = taskData.find(t => t.id === taskId);
        if (task) {
            task.status = newStatus;
            this.saveTasks();
            this.renderTasks(document.querySelector('.task-filter.active').dataset.filter);
        }
    },
    updateTaskNotes(taskId, notes) {
        const task = taskData.find(t => t.id === taskId);
        if (task) {
            task.notes = notes;
            this.saveTasks();
        }
    },
    getCalendarLink(t){const b="https://www.google.com/calendar/render?action=TEMPLATE",e=encodeURIComponent(`ST: ${t.title}`),d=`${t.dates.start}T090000/${t.dates.end}T170000`,s=encodeURIComponent(t.desc.replace(/<br>/g,'\n').replace(/<[^>]*>?/gm,'')),l=encodeURIComponent("Sextant Coffee Roasters, 539 Valencia St, San Francisco, CA");return`${b}&text=${e}&dates=${d}&details=${s}&location=${l}`;},
    showTechModal(techKey){const details=techDetails[techKey];if(!details)return;const modal=document.createElement('div');modal.className='tech-modal';modal.onclick=()=>this.hideModal('techModalContainer');modal.innerHTML=`<div class="menu-modal-content card" onclick="event.stopPropagation()"><button class="menu-modal-close" onclick="Content.hideModal('techModalContainer')">&times;</button><h3 class="heading-1" style="color:${details.color};">${details.title}</h3><p class="body-regular mt-4">${details.desc}</p></div>`;this.app.DOM.techModalContainer.appendChild(modal);setTimeout(()=>modal.classList.add('visible'),10);},
};

window.showMenuCategory=c=>Content.showMenuCategory(c);
window.toggleExpand=i=>i.classList.toggle('expanded');
window.setVenueMode=m=>Content.setVenueMode(m);
window.resetVenueLayout=()=>Content.resetVenueLayout();
window.calculateRevenue=()=>Content.calculateRevenue();

document.addEventListener('DOMContentLoaded',()=>{Chart.register(ChartDataLabels);try{App.init();}catch(e){window.onerror("Initialization failed","","",0,e);}});
</script>
</body>
</html>
